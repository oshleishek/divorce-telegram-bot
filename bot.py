"""
Telegram Bot –¥–ª—è –ª—ñ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∞–¥–≤–æ–∫–∞—Ç—ñ–≤ (–†–æ–∑–ª—É—á–µ–Ω–Ω—è)
–í–µ—Ä—Å—ñ—è: 3.1 ULTIMATE IMPROVED
–ê–≤—Ç–æ—Ä: –°—Ç–∞—Å + Claude + Gemini

–ó–ú–Ü–ù–ò –í v3.1 (–ü–û–ö–†–ê–©–ï–ù–ê –í–û–†–û–ù–ö–ê):
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ –†–æ–∑—à–∏—Ä–µ–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü—ñ—è: 4 ‚Üí 10 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ (A1, A2, B1, B2, C1, C2, D1, D2, E1, E2)
‚úÖ –î–µ—Ç–∞–ª—å–Ω—ñ –º–∏–Ω—ñ-–∫–µ–π—Å–∏ (—Ä–µ–∞–ª—å–Ω—ñ —ñ—Å—Ç–æ—Ä—ñ—ó –∑ —ñ–º–µ–Ω–∞–º–∏, –º—ñ—Å—Ç–∞–º–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏)
‚úÖ –ú—ñ–∫—Ä–æ–∫–æ–º—ñ—Ç–∏ –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ ("‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ...")
‚úÖ –ñ–∏–≤—ñ —Ç–µ–∫—Å—Ç–∏ –∑ –µ–º–ø–∞—Ç—ñ—î—é —Ç–∞ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º–∏
‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –æ—Ñ—Ñ–µ—Ä –∑ —Ä–µ–≤–µ—Ä—Å-—Ä–∏–∑–∏–∫–æ–º —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—î—é
‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç—É

–ó–ë–ï–†–ï–ñ–ï–ù–û –ó v3.0:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó (Analytics sheet)
‚úÖ –í—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (All_Users sheet)
‚úÖ –Ü–º'—è –∑ contact
‚úÖ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∫–≤—ñ–∑ (15 —Ö–≤) —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω (60 —Å–µ–∫)
‚úÖ Flask web-server –¥–ª—è Render
‚úÖ –¢–µ–∫—Å—Ç–∏ –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞—Ö
"""

import os
import logging
import random
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ReactionTypeEmoji
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, MessageHandler, filters, ContextTypes
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import requests
from flask import Flask
import threading
import asyncio
from telegram.constants import ChatAction
import re

# =====================================================
# –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –õ–û–ì–£–í–ê–ù–ù–Ø
# =====================================================

logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# =====================================================
# –ö–û–ù–°–¢–ê–ù–¢–ò
# =====================================================

BOT_TOKEN = os.environ.get('BOT_TOKEN', 'YOUR_BOT_TOKEN_HERE')
MAKE_WEBHOOK_URL = os.environ.get('MAKE_WEBHOOK_URL', '')
GOOGLE_SHEET_URL = os.environ.get('GOOGLE_SHEET_URL')
ADMIN_ID = os.environ.get('ADMIN_ID')

# =====================================================
# –ü–Ü–î–ö–õ–Æ–ß–ï–ù–ù–Ø –î–û GOOGLE SHEETS
# =====================================================

def init_google_sheets():
    """–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Google Sheets"""
    try:
        required_vars = [
            'GOOGLE_PROJECT_ID', 
            'GOOGLE_PRIVATE_KEY', 
            'GOOGLE_CLIENT_EMAIL',
            'GOOGLE_SHEET_URL'
        ]
        missing_vars = [var for var in required_vars if not os.environ.get(var)]
        
        if missing_vars:
            logger.warning(f"‚ö†Ô∏è Google Sheets –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ (–≤—ñ–¥—Å—É—Ç–Ω—ñ –∑–º—ñ–Ω–Ω—ñ: {', '.join(missing_vars)})")
            return None, None, None
        
        scope = ['https://spreadsheets.google.com/feeds',
                 'https://www.googleapis.com/auth/drive']
        
        creds_dict = {
            "type": "service_account",
            "project_id": os.environ.get('GOOGLE_PROJECT_ID'),
            "private_key_id": os.environ.get('GOOGLE_PRIVATE_KEY_ID'),
            "private_key": os.environ.get('GOOGLE_PRIVATE_KEY', '').replace('\\n', '\n'),
            "client_email": os.environ.get('GOOGLE_CLIENT_EMAIL'),
            "client_id": os.environ.get('GOOGLE_CLIENT_ID'),
            "auth_uri": "https://accounts.google.com/o/oauth2/auth",
            "token_uri": "https://oauth2.googleapis.com/token",
            "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
            "client_x509_cert_url": os.environ.get('GOOGLE_CERT_URL')
        }
        
        logger.info("üîÑ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Google Sheets...")
        creds = ServiceAccountCredentials.from_json_keyfile_dict(creds_dict, scope)
        client = gspread.authorize(creds)
        
        logger.info(f"üîÑ –í—ñ–¥–∫—Ä–∏–≤–∞—é —Ç–∞–±–ª–∏—Ü—é –ø–æ URL...")
        spreadsheet = client.open_by_url(GOOGLE_SHEET_URL)
        
        # –û—Ç—Ä–∏–º—É—î–º–æ –∞–±–æ —Å—Ç–≤–æ—Ä—é—î–º–æ –ª–∏—Å—Ç–∏
        try:
            leads_sheet = spreadsheet.worksheet("Leads")
        except gspread.WorksheetNotFound:
            leads_sheet = spreadsheet.add_worksheet("Leads", rows=1000, cols=20)
            # –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–¥–æ–¥–∞–ª–∏ segment_name)
            leads_sheet.append_row([
                "–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è", "Telegram ID", "Username", "–Ü–º'—è", "–¢–µ–ª–µ—Ñ–æ–Ω",
                "–î—ñ—Ç–∏", "–ó–≥–æ–¥–∞ —Å—É–ø—Ä—É–≥–∞", "–ú–∞–π–Ω–æ", "–ú—ñ—Å—Ü–µ —Å—É–ø—Ä—É–≥–∞", "–¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å",
                "–°–µ–≥–º–µ–Ω—Ç", "–ù–∞–∑–≤–∞ —Å–µ–≥–º–µ–Ω—Ç—É", "–í–∞—Ä—Ç—ñ—Å—Ç—å", "–°—Ç—Ä–æ–∫–∏", "–°—Ç–∞—Ç—É—Å"
            ])
        
        try:
            analytics_sheet = spreadsheet.worksheet("Analytics")
        except gspread.WorksheetNotFound:
            analytics_sheet = spreadsheet.add_worksheet("Analytics", rows=5000, cols=10)
            analytics_sheet.append_row([
                "Timestamp", "Telegram ID", "Username", "Event", "Details"
            ])
        
        try:
            all_users_sheet = spreadsheet.worksheet("All_Users")
        except gspread.WorksheetNotFound:
            all_users_sheet = spreadsheet.add_worksheet("All_Users", rows=5000, cols=10)
            all_users_sheet.append_row([
                "–î–∞—Ç–∞ –ø–µ—Ä—à–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É", "Telegram ID", "Username", 
                "First Name", "Last Name", "–ó–∞–≤–µ—Ä—à–∏–≤ –∫–≤—ñ–∑", "–°—Ç–∞—Ç—É—Å"
            ])
        
        logger.info(f"‚úÖ Google Sheets –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ")
        logger.info(f"  üìä Leads: {leads_sheet.title}")
        logger.info(f"  üìà Analytics: {analytics_sheet.title}")
        logger.info(f"  üë• All Users: {all_users_sheet.title}")
        
        return leads_sheet, analytics_sheet, all_users_sheet
        
    except Exception as e:
        logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Google Sheets: {type(e).__name__}: {str(e)}")
        return None, None, None

# –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ sheets
SHEETS_LEADS, SHEETS_ANALYTICS, SHEETS_ALL_USERS = init_google_sheets()

# =====================================================
# –ê–ù–ê–õ–Ü–¢–ò–ö–ê - –õ–û–ì–£–í–ê–ù–ù–Ø –ü–û–î–Ü–ô
# =====================================================

async def log_event(telegram_id, username, event, details=""):
    """–õ–æ–≥—É—î –∫–æ–∂–Ω—É –ø–æ–¥—ñ—é –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –∫–æ–Ω–≤–µ—Ä—Å—ñ—ó"""
    
    if SHEETS_ANALYTICS is None:
        return
    
    try:
        row = [
            datetime.now().isoformat(),
            str(telegram_id),
            username or "",
            event,
            details
        ]
        
        SHEETS_ANALYTICS.append_row(row)
        logger.info(f"üìä Analytics: {telegram_id} ‚Üí {event}")
        
    except Exception as e:
        logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–¥—ñ—ó: {e}")

async def save_all_user(telegram_id, username, first_name, last_name):
    """–ó–±–µ—Ä—ñ–≥–∞—î –í–°–Ü–• –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —Ö—Ç–æ –Ω–∞—Ç–∏—Å–Ω—É–≤ /start"""
    
    if SHEETS_ALL_USERS is None:
        return
    
    try:
        # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤–∂–µ —î —Ç–∞–∫–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
        existing = SHEETS_ALL_USERS.find(str(telegram_id), in_column=2)
        if existing:
            logger.info(f"üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á {telegram_id} –≤–∂–µ –≤ –±–∞–∑—ñ")
            return
        
        row = [
            datetime.now().isoformat(),
            str(telegram_id),
            username or "",
            first_name or "",
            last_name or "",
            "–ù—ñ",  # –ó–∞–≤–µ—Ä—à–∏–≤ –∫–≤—ñ–∑
            "new"   # –°—Ç–∞—Ç—É—Å
        ]
        
        SHEETS_ALL_USERS.append_row(row)
        logger.info(f"üë• –ù–æ–≤–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤ –±–∞–∑—ñ: {username or telegram_id}")
        
    except Exception as e:
        logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: {e}")

# =====================================================
# WEB-–°–ï–†–í–ï–† –î–õ–Ø RENDER (–©–û–ë –ù–ï –ó–ê–°–ò–ù–ê–í)
# =====================================================

app = Flask(__name__)

@app.route('/')
def home():
    return "‚úÖ Divorce Bot v3.1 is running!", 200

@app.route('/health')
def health():
    return {"status": "ok", "bot": "running", "version": "3.1"}, 200

def run_flask():
    """–ó–∞–ø—É—Å–∫ Flask –≤ –æ–∫—Ä–µ–º–æ–º—É –ø–æ—Ç–æ—Ü—ñ"""
    port = int(os.environ.get('PORT', 10000))
    app.run(host='0.0.0.0', port=port, debug=False, use_reloader=False)

# =====================================================
# –†–û–ó–®–ò–†–ï–ù–ê –õ–û–ì–Ü–ö–ê –°–ï–ì–ú–ï–ù–¢–ê–¶–Ü–á (10 –°–ï–ì–ú–ï–ù–¢–Ü–í)
# =====================================================

def determine_segment(user_data):
    """
    –í–∏–∑–Ω–∞—á–∞—î —Å–µ–≥–º–µ–Ω—Ç –∑ 10 –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
    
    –°–ï–ì–ú–ï–ù–¢–ò:
    A1 - –ï–∫—Å–ø—Ä–µ—Å (–Ω–µ–º–∞—î –¥—ñ—Ç–µ–π, —î –∑–≥–æ–¥–∞, –Ω–µ–º–∞—î –º–∞–π–Ω–∞, —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ)
    A2 - –ü—Ä–æ—Å—Ç–∏–π (–Ω–µ–º–∞—î –¥—ñ—Ç–µ–π, —î –∑–≥–æ–¥–∞, –Ω–µ–≤–µ–ª–∏–∫–µ –º–∞–π–Ω–æ/–Ω–µ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ)
    B1 - –ó–∞—Ö–∏—Å—Ç –¥—ñ—Ç–µ–π (—î –¥—ñ—Ç–∏, –Ω–µ–º–∞—î –∑–≥–æ–¥–∏)
    B2 - –ú–∏—Ä–Ω–∞ –¥–æ–º–æ–≤–ª–µ–Ω—ñ—Å—Ç—å (—î –¥—ñ—Ç–∏, —î –∑–≥–æ–¥–∞)
    C1 - –°–∫–ª–∞–¥–Ω–∏–π —Ä–æ–∑–¥—ñ–ª (–±–∞–≥–∞—Ç–æ –º–∞–π–Ω–∞ + –¥—ñ—Ç–∏)
    C2 - –ï–∫–æ–Ω–æ–º–Ω–∏–π —Ä–æ–∑–¥—ñ–ª (—î –º–∞–π–Ω–æ, –Ω–µ–º–∞—î –¥—ñ—Ç–µ–π)
    D1 - –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏–π VIP (–∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º, —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ)
    D2 - –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç (–∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º, –Ω–µ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ)
    E1 - –ù–µ–≤—ñ–¥–æ–º–æ –¥–µ —Å—É–ø—Ä—É–≥ (–Ω–µ –∑–Ω–∞—é—Ç—å –∞–¥—Ä–µ—Å—É, —Å—É–ø—Ä—É–≥ –∑–≥–æ–¥–Ω–∏–π)
    E2 - –†–æ–∑—à—É–∫ —Å—É–ø—Ä—É–≥–∞ (–Ω–µ –∑–Ω–∞—é—Ç—å –∞–¥—Ä–µ—Å—É, —Å—É–ø—Ä—É–≥ –ø—Ä–æ—Ç–∏)
    """
    
    has_children = user_data.get('has_children') == 'yes'
    spouse_consent = user_data.get('spouse_consent')
    property_dispute = user_data.get('property_dispute')
    spouse_location = user_data.get('spouse_location')
    urgency = user_data.get('urgency')
    
    # –°–ï–ì–ú–ï–ù–¢ D1/D2: –ú–Ü–ñ–ù–ê–†–û–î–ù–Ü (–ø–µ—Ä—à–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
    if spouse_location == 'abroad':
        if urgency == 'high':
            return ('D1', 'üåç –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è (VIP)', '12000-15000 –≥—Ä–Ω', '3-4 –º—ñ—Å—è—Ü—ñ')
        else:
            return ('D2', 'üåç –ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è (–°—Ç–∞–Ω–¥–∞—Ä—Ç)', '9000-12000 –≥—Ä–Ω', '3-4 –º—ñ—Å—è—Ü—ñ')
    
    # –°–ï–ì–ú–ï–ù–¢ E1/E2: –ù–ï–í–Ü–î–û–ú–ï –ú–Ü–°–¶–ï–ó–ù–ê–•–û–î–ñ–ï–ù–ù–Ø
    if spouse_location == 'unknown':
        if spouse_consent == 'no':
            return ('E2', 'üîç –†–æ–∑–ª—É—á–µ–Ω–Ω—è –∑ —Ä–æ–∑—à—É–∫–æ–º —Å—É–ø—Ä—É–≥–∞', '13000-16000 –≥—Ä–Ω', '5-7 –º—ñ—Å—è—Ü—ñ–≤')
        else:
            return ('E1', 'üîç –†–æ–∑–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –∞–¥—Ä–µ—Å–∏ —Å—É–ø—Ä—É–≥–∞', '10000-13000 –≥—Ä–Ω', '4-6 –º—ñ—Å—è—Ü—ñ–≤')
    
    # –°–ï–ì–ú–ï–ù–¢ A1/A2: –®–í–ò–î–ö–Ü (–Ω–µ–º–∞—î –¥—ñ—Ç–µ–π)
    if not has_children:
        if spouse_consent == 'yes' and property_dispute == 'no':
            if urgency == 'high':
                return ('A1', '‚ö°Ô∏è –ï–∫—Å–ø—Ä–µ—Å-—Ä–æ–∑–ª—É—á–µ–Ω–Ω—è', '4000-6000 –≥—Ä–Ω', '2-3 –º—ñ—Å—è—Ü—ñ')
            else:
                return ('A2', '‚úÖ –ü—Ä–æ—Å—Ç–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è', '3500-5000 –≥—Ä–Ω', '2-4 –º—ñ—Å—è—Ü—ñ')
        elif property_dispute == 'yes':
            return ('C2', 'üí∞ –†–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞', '12000-18000 –≥—Ä–Ω', '5-8 –º—ñ—Å—è—Ü—ñ–≤')

    # –°–ï–ì–ú–ï–ù–¢ C1: –°–ö–õ–ê–î–ù–ò–ô –†–û–ó–î–Ü–õ
    if property_dispute == 'yes' and has_children:
        return ('C1', 'üíº –°–∫–ª–∞–¥–Ω–∏–π —Ä–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞', '18000-30000 –≥—Ä–Ω', '6-9 –º—ñ—Å—è—Ü—ñ–≤')
    
    # –°–ï–ì–ú–ï–ù–¢ B1/B2: –ó –î–Ü–¢–¨–ú–ò
    if has_children:
        if spouse_consent == 'no':
            return ('B1', 'üõ° –ó–∞—Ö–∏—Å—Ç —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤ –¥–∏—Ç–∏–Ω–∏', '14000-18000 –≥—Ä–Ω', '4-7 –º—ñ—Å—è—Ü—ñ–≤')
        else:
            return ('B2', 'üë®‚Äçüë©‚Äçüëß –†–æ–∑–ª—É—á–µ–Ω–Ω—è –∑—ñ –∑–≥–æ–¥–æ—é (–∑ –¥—ñ—Ç—å–º–∏)', '10000-14000 –≥—Ä–Ω', '3-5 –º—ñ—Å—è—Ü—ñ–≤')
    
    # –î–ï–§–û–õ–¢–ù–ò–ô
    return ('B2', 'üìã –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è', '10000-12000 –≥—Ä–Ω', '4-6 –º—ñ—Å—è—Ü—ñ–≤')

# =====================================================
# üìù –ü–û–ö–†–ê–©–ï–ù–Ü –¢–ï–ö–°–¢–ò –î–õ–Ø –ö–û–†–ò–°–¢–£–í–ê–ß–ê
# =====================================================

# üìù –¢–ï–ö–°–¢: –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è –ø—Ä–∏ /start (–ü–û–ö–†–ê–©–ï–ù–û)
TEXT_WELCOME = """
üëã <b>–ü—Ä–∏–≤—ñ—Ç!</b>

–Ø –¥–æ–ø–æ–º–æ–∂—É —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—è <b>—Å–∫—ñ–ª—å–∫–∏ –∫–æ—à—Ç—É—î —ñ —Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–∏–≤–∞—Ç–∏–º–µ —Å–∞–º–µ –≤–∞—à–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è</b>.

–†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∑–∞–π–º–µ <b>2 —Ö–≤–∏–ª–∏–Ω–∏</b> —ñ –≤—ñ–Ω –∞–±—Å–æ–ª—é—Ç–Ω–æ <b>–±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π</b>.

<i>–ö–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è —É–Ω—ñ–∫–∞–ª—å–Ω–∞. –¢–æ–º—É —è –∑–∞–¥–∞–º –∫—ñ–ª—å–∫–∞ –ø–∏—Ç–∞–Ω—å, —â–æ–± –¥–∞—Ç–∏ —Ç–æ—á–Ω–∏–π –ø—Ä–æ–≥–Ω–æ–∑ —Å–∞–º–µ –¥–ª—è –≤–∞—Å.</i>

–ì–æ—Ç–æ–≤—ñ –ø–æ—á–∞—Ç–∏?
"""

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 1 (–ü–û–ö–†–ê–©–ï–ù–û –∑ –ø–æ—è—Å–Ω–µ–Ω–Ω—è–º)
TEXT_Q1 = """
<b>–ü–∏—Ç–∞–Ω–Ω—è 1 –∑ 6</b>

–ß–∏ —î —É –≤–∞—Å —Å–ø—ñ–ª—å–Ω—ñ –¥—ñ—Ç–∏ (–¥–æ 18 —Ä–æ–∫—ñ–≤)?

<i>–¶–µ –≤–∞–∂–ª–∏–≤–æ, –±–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –¥—ñ—Ç–µ–π –≤–ø–ª–∏–≤–∞—î –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É —Ç–∞ —Å—Ç—Ä–æ–∫–∏ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è.</i>
"""

# üìù –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–ò (–Ω–æ–≤—ñ —Ç–µ–∫—Å—Ç–∏ –ø—ñ—Å–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π)
MICROCOMMIT_Q1_YES = "‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ, —î –¥—ñ—Ç–∏.\n\n"
MICROCOMMIT_Q1_NO = "‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ, –¥—ñ—Ç–µ–π –Ω–µ–º–∞—î.\n\n"

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 2 (–ü–û–ö–†–ê–©–ï–ù–û)
TEXT_Q2 = """<b>–ü–∏—Ç–∞–Ω–Ω—è 2 –∑ 6</b>

–ß–∏ –∑–≥–æ–¥–µ–Ω(–Ω–∞) –≤–∞—à —á–æ–ª–æ–≤—ñ–∫/–¥—Ä—É–∂–∏–Ω–∞ –Ω–∞ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è?

<i>–Ø–∫—â–æ –æ–±–∏–¥–≤–∞ –∑–≥–æ–¥–Ω—ñ - –ø—Ä–æ—Ü–µ—Å –±—É–¥–µ —à–≤–∏–¥—à–∏–º. –Ø–∫—â–æ —Ö—Ç–æ—Å—å –ø—Ä–æ—Ç–∏ - —Ü–µ –Ω–µ –ø–µ—Ä–µ—à–∫–æ–¥–∞, –ø—Ä–æ—Å—Ç–æ —Ç—Ä–∏–≤–∞—Ç–∏–º–µ –¥–æ–≤—à–µ.</i>
"""

# üìù –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–ò –¥–ª—è Q2
MICROCOMMIT_Q2_YES = "‚úÖ –î–æ–±—Ä–µ, —â–æ —î –∑–≥–æ–¥–∞.\n\n"
MICROCOMMIT_Q2_NO = "‚úÖ –†–æ–∑—É–º—ñ—é, —Ü–µ —Å–∫–ª–∞–¥–Ω—ñ—à–µ. –ê–ª–µ —Ä–æ–∑–ª—É—á–∏—Ç–∏—Å—è –º–æ–∂–Ω–∞ —ñ –±–µ–∑ –∑–≥–æ–¥–∏.\n\n"
MICROCOMMIT_Q2_UNKNOWN = "‚úÖ –î–æ–±—Ä–µ, –∑'—è—Å—É—î–º–æ –¥–∞–ª—ñ.\n\n"

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 3 (–ü–û–ö–†–ê–©–ï–ù–û)
TEXT_Q3 = """<b>–ü–∏—Ç–∞–Ω–Ω—è 3 –∑ 6</b>

–ß–∏ —î —Å–ø—ñ–ª—å–Ω–µ –º–∞–π–Ω–æ, —è–∫–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥—ñ–ª–∏—Ç–∏?
<i>(–∫–≤–∞—Ä—Ç–∏—Ä–∞, –±—É–¥–∏–Ω–æ–∫, –∑–µ–º–ª—è, –∞–≤—Ç–æ–º–æ–±—ñ–ª—å, –±—ñ–∑–Ω–µ—Å, –≤–µ–ª–∏–∫—ñ –∑–∞–æ—â–∞–¥–∂–µ–Ω–Ω—è —Ç–æ—â–æ)</i>

<i>–Ø–∫—â–æ –º–∞–π–Ω–∞ –º–∞–ª–æ –∞–±–æ –≤–∏ –¥–æ–º–æ–≤–∏–ª–∏—Å—è - –ø—Ä–æ—Ü–µ—Å –ø—Ä–æ—Å—Ç—ñ—à–∏–π. –Ø–∫—â–æ —î –≤–µ–ª–∏–∫—ñ –∞–∫—Ç–∏–≤–∏ - –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ä–æ–∑–¥—ñ–ª.</i>
"""

# üìù –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–ò –¥–ª—è Q3
MICROCOMMIT_Q3_YES = "‚úÖ –ê–≥–∞, —Ä–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞. –¶–µ –≤–∏–º–∞–≥–∞—î –æ—Å–æ–±–ª–∏–≤–æ—ó —É–≤–∞–≥–∏.\n\n"
MICROCOMMIT_Q3_NO = "‚úÖ –î–æ–±—Ä–µ, –º–∞–π–Ω–∞ –Ω–µ–º–∞—î –∞–±–æ –≤—Ä–µ–≥—É–ª—å–æ–≤–∞–Ω–æ.\n\n"
MICROCOMMIT_Q3_UNSURE = "‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ, —Ä–æ–∑–±–µ—Ä–µ–º–æ—Å—è.\n\n"

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 4 (–ü–û–ö–†–ê–©–ï–ù–û)
TEXT_Q4 = """<b>–ü–∏—Ç–∞–Ω–Ω—è 4 –∑ 6</b>

–î–µ –∑–∞—Ä–∞–∑ –ø–µ—Ä–µ–±—É–≤–∞—î—Ç–µ –≤–∏ —Ç–∞ –≤–∞—à —á–æ–ª–æ–≤—ñ–∫/–¥—Ä—É–∂–∏–Ω–∞?

<i>–¶–µ –≤–∏–∑–Ω–∞—á–∞—î, —á–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–∞–º –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–∏–π –ø—Ä–æ—Ü–µ—Å —Ç–∞ –¥–æ —è–∫–æ–≥–æ —Å–∞–º–µ —Å—É–¥—É –ø–æ–¥–∞–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏.</i>
"""

# üìù –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–ò –¥–ª—è Q4
MICROCOMMIT_Q4_UKRAINE = "‚úÖ –î–æ–±—Ä–µ, –æ–±–∏–¥–≤–∞ –≤ –£–∫—Ä–∞—ó–Ω—ñ.\n\n"
MICROCOMMIT_Q4_ABROAD = "‚úÖ –ó—Ä–æ–∑—É–º—ñ–ª–æ, —î –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç. –û—Ä–≥–∞–Ω—ñ–∑—É—î–º–æ –≤—Å–µ –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ.\n\n"
MICROCOMMIT_Q4_UNKNOWN = "‚úÖ –†–æ–∑—É–º—ñ—é. –Ñ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –≤—ñ–¥–æ–º–æ—ó –∞–¥—Ä–µ—Å–∏.\n\n"

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 5 (–ü–û–ö–†–ê–©–ï–ù–û)
TEXT_Q5 = """<b>–ü–∏—Ç–∞–Ω–Ω—è 5 –∑ 6</b>

–ù–∞—Å–∫—ñ–ª—å–∫–∏ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è?

<i>–¶–µ –¥–æ–ø–æ–º–æ–∂–µ –ø—ñ–¥—ñ–±—Ä–∞—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π –ø–∞–∫–µ—Ç –ø–æ—Å–ª—É–≥.</i>
"""

# üìù –¢–ï–ö–°–¢: –ü–∏—Ç–∞–Ω–Ω—è 6 (–ü–û–ö–†–ê–©–ï–ù–û, –°–ò–õ–¨–ù–ê –†–ê–ú–ö–ê - –ë–ï–ó –ñ–ò–†–ù–û–ì–û)
TEXT_Q6_PHONE = """
‚úÖ –î—è–∫—É—é –∑–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ!

–û—Å—Ç–∞–Ω–Ω—î –ø–∏—Ç–∞–Ω–Ω—è (6 –∑ 6)

–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫.

–¶–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ —ñ –Ω—ñ –¥–æ —á–æ–≥–æ –≤–∞—Å –Ω–µ –∑–æ–±–æ–≤'—è–∑—É—î. –ú–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—î–º–æ –¥–∞–Ω—ñ —Ç—Ä–µ—Ç—ñ–º –æ—Å–æ–±–∞–º —ñ –Ω–µ —Ä–æ–∑—Å–∏–ª–∞—î–º–æ —Å–ø–∞–º.

<i>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ ‚¨áÔ∏è</i>
"""

# =====================================================
# –ñ–ò–í–Ü –ü–†–ò–ö–õ–ê–î–ò (–ë–ï–ó –ó–ê–ì–û–õ–û–í–ö–Ü–í, –ù–ê–¢–ò–í–ù–Ü)
# =====================================================

MINI_CASES = {
    # –î–ª—è —Ç–∏—Ö, —É –∫–æ–≥–æ –Ñ –î–Ü–¢–ò + –ù–ï–ú–ê–Ñ –ó–ì–û–î–ò
    'yes_children_no_consent': [
        """
<i>–†–æ–∑—É–º—ñ—é –≤–∞—à—É —Ç—Ä–∏–≤–æ–≥—É. –¶–µ —Ä–æ–∑–ø–æ–≤—Å—é–¥–∂–µ–Ω–∞ —Å–∏—Ç—É–∞—Ü—ñ—è.

–ù–µ—â–æ–¥–∞–≤–Ω–æ –º–∏ –¥–æ–ø–æ–º–∞–≥–∞–ª–∏ –ú–∞—Ä–∏–Ω—ñ –∑ –•–∞—Ä–∫–æ–≤–∞. –á—ó —á–æ–ª–æ–≤—ñ–∫ —Ç–µ–∂ –±—É–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ –ø—Ä–æ—Ç–∏ —ñ –ø–æ–≥—Ä–æ–∂—É–≤–∞–≤ –∑–∞–±—Ä–∞—Ç–∏ —Å–∏–Ω–∞. –ê–ª–µ –∑–∞–∫–æ–Ω –Ω–∞ –±–æ—Ü—ñ —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤ –¥–∏—Ç–∏–Ω–∏.

–ú–∏ –∑—ñ–±—Ä–∞–ª–∏ –¥–æ–∫–∞–∑–∏ —Ç—É—Ä–±–æ—Ç–∏ –º–∞—Ç–µ—Ä—ñ, —ñ —Å—É–¥ –∑–∞–ª–∏—à–∏–≤ –¥–∏—Ç–∏–Ω—É –∑ –Ω–µ—é, –≤—Å—Ç–∞–Ω–æ–≤–∏–≤—à–∏ —á—ñ—Ç–∫–∏–π –≥—Ä–∞—Ñ—ñ–∫ –∑—É—Å—Ç—Ä—ñ—á–µ–π –¥–ª—è –±–∞—Ç—å–∫–∞. –ì–æ–ª–æ–≤–Ω–µ ‚Äî –Ω–µ –ø–∞–Ω—ñ–∫—É–≤–∞—Ç–∏ —ñ –¥—ñ—è—Ç–∏ —é—Ä–∏–¥–∏—á–Ω–æ –≥—Ä–∞–º–æ—Ç–Ω–æ.</i>
""",
        """
<i>–°–∏—Ç—É–∞—Ü—ñ—è –Ω–µ–ø—Ä–æ—Å—Ç–∞, –∞–ª–µ –≤–∏—Ä—ñ—à—É–≤–∞–Ω–∞.

–£ –Ω–∞—Å –±—É–≤ –∫–ª—ñ—î–Ω—Ç –û–ª–µ–≥ –∑ –î–Ω—ñ–ø—Ä–∞. –î—Ä—É–∂–∏–Ω–∞ —Ö–æ—Ç—ñ–ª–∞ –æ–±–º–µ–∂–∏—Ç–∏ –π–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è –∑ —Å–∏–Ω–æ–º —á–µ—Ä–µ–∑ –æ–±—Ä–∞–∑–∏. –ú–∏ –¥–æ–ø–æ–º–æ–≥–ª–∏ –π–æ–º—É –∑—ñ–±—Ä–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–∞ –¥–æ–∫–∞–∑–∏ —É—á–∞—Å—Ç—ñ —É –≤–∏—Ö–æ–≤–∞–Ω–Ω—ñ.

–°—É–¥ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥—Ö–∏–ª–∏–≤ –≤–∏–º–æ–≥–∏ –¥—Ä—É–∂–∏–Ω–∏ –ø—Ä–æ –æ–±–º–µ–∂–µ–Ω–Ω—è. –ë–∞—Ç—å–∫–æ –∑–±–µ—Ä—ñ–≥ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–π –∑–≤'—è–∑–æ–∫ –∑ –¥–∏—Ç–∏–Ω–æ—é. –í–∞—à—ñ –ø—Ä–∞–≤–∞ —è–∫ –±–∞—Ç—å–∫–∞ –º–æ–∂–Ω–∞ —ñ —Ç—Ä–µ–±–∞ –∑–∞—Ö–∏—â–∞—Ç–∏.</i>
"""
    ],
    
    # –î–ª—è —Ç–∏—Ö, —É –∫–æ–≥–æ –ù–ï–ú–ê–Ñ –î–Ü–¢–ï–ô + –Ñ –ó–ì–û–î–ê
    'no_children_yes_consent': [
        """
<i>–¶–µ —á—É–¥–æ–≤–æ, —â–æ –≤–∏ –¥–æ–º–æ–≤–∏–ª–∏—Å—è –º–∏—Ä–Ω–æ. –£ —Ç–∞–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –Ω–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –∑—Ä–æ–±–∏—Ç–∏ —Ç–∞–∫, —â–æ–± –≤–∏ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ –≤–∏—Ç—Ä–∞—á–∞–ª–∏ –Ω–∞ —Ü–µ —á–∞—Å.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –û–∫—Å–∞–Ω–∞ –∑ –ö–∏—î–≤–∞ –∑–≤–µ—Ä–Ω—É–ª–∞—Å—è –∑ –∑–∞–ø–∏—Ç–æ–º "–≤—Å–µ –ø—ñ–¥ –∫–ª—é—á". –ú–∏ –≤—Å–µ –æ—Ñ–æ—Ä–º–∏–ª–∏ —Å–∞–º—ñ. –á–º –∑ —á–æ–ª–æ–≤—ñ–∫–æ–º –Ω–∞–≤—ñ—Ç—å –Ω–µ –¥–æ–≤–µ–ª–æ—Å—è –π—Ç–∏ –¥–æ —Å—É–¥—É ‚Äî –≤–æ–Ω–∏ –ø—Ä–æ—Å—Ç–æ –æ—Ç—Ä–∏–º–∞–ª–∏ –≥–æ—Ç–æ–≤–µ —Ä—ñ—à–µ–Ω–Ω—è –ø–æ—à—Ç–æ—é —á–µ—Ä–µ–∑ 2.5 –º—ñ—Å—è—Ü—ñ.</i>
""",
        """
<i>–ö–æ–ª–∏ —î –∑–≥–æ–¥–∞, –ø—Ä–æ—Ü–µ—Å –º–æ–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ –¥—É–∂–µ —à–≤–∏–¥–∫–æ —ñ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ.

–ù–∞—à –∫–ª—ñ—î–Ω—Ç –ê–Ω–¥—Ä—ñ–π –∑ –û–¥–µ—Å–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–≤, —â–æ –∑–∞–≥—Ä—É–∑–Ω–µ –≤ –±—é—Ä–æ–∫—Ä–∞—Ç—ñ—ó. –ú–∏ –ø—ñ–¥–≥–æ—Ç—É–≤–∞–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å. –ô–æ–≥–æ —É—á–∞—Å—Ç—å –∑–∞–π–Ω—è–ª–∞ —Å—É–º–∞—Ä–Ω–æ 1 –≥–æ–¥–∏–Ω—É —á–∞—Å—É, —Ä–µ—à—Ç—É –º–∏ –∑—Ä–æ–±–∏–ª–∏ —Å–∞–º—ñ.</i>
"""
    ],
    
    # –î–ª—è —Ç–∏—Ö, —É –∫–æ–≥–æ –Ñ –ú–ê–ô–ù–û
    'yes_property': [
        """
<i>–†–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞ ‚Äî —Ü–µ –∑–∞–≤–∂–¥–∏ –¥–µ–ª—ñ–∫–∞—Ç–Ω–∏–π –º–æ–º–µ–Ω—Ç, –¥–µ –≤–∞–∂–ª–∏–≤–æ –≤—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫–æ–∂–Ω—É –¥–µ—Ç–∞–ª—å.

–ù–µ—â–æ–¥–∞–≤–Ω–æ –º–∏ –≤–µ–ª–∏ —Å–ø—Ä–∞–≤—É, –¥–µ –¥—Ä—É–∂–∏–Ω–∞ –≤–∫–ª–∞–ª–∞ –≤ –∫–≤–∞—Ä—Ç–∏—Ä—É –ø–æ–¥–∞—Ä–æ–≤–∞–Ω—ñ –±–∞—Ç—å–∫–∞–º–∏ –∫–æ—à—Ç–∏, –∞ —á–æ–ª–æ–≤—ñ–∫ –ø–µ—Ä–µ–∂–∏–≤–∞–≤ –∑–∞ —Å–≤—ñ–π –±—ñ–∑–Ω–µ—Å.

–ú–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥—ñ–ª–∏–ª–∏ "50/50", –∞ –¥–æ–≤–µ–ª–∏ –æ—Å–æ–±–∏—Å—Ç–∏–π –≤–Ω–µ—Å–æ–∫ –¥—Ä—É–∂–∏–Ω–∏ (–≤–æ–Ω–∞ –æ—Ç—Ä–∏–º–∞–ª–∞ –±—ñ–ª—å—à—É —á–∞—Å—Ç–∫—É –∂–∏—Ç–ª–∞) —ñ –∑–∞—Ö–∏—Å—Ç–∏–ª–∏ –±—ñ–∑–Ω–µ—Å —á–æ–ª–æ–≤—ñ–∫–∞ –≤—ñ–¥ —Ä–æ–∑–¥—ñ–ª—É. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å –º–æ–∂–ª–∏–≤–∞.</i>
"""
    ],
    
    # –î–ª—è —Ç–∏—Ö, —Ö—Ç–æ –ó–ê –ö–û–†–î–û–ù–û–ú
    'abroad': [
        """
<i>–í—ñ–¥—Å—Ç–∞–Ω—å –∑–∞—Ä–∞–∑ –Ω–µ —î –ø–µ—Ä–µ—à–∫–æ–¥–æ—é. –ë–∞–≥–∞—Ç–æ –Ω–∞—à–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤ —Ä–æ–∑–ª—É—á–∞—é—Ç—å—Å—è –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –Ø–Ω–∞ –≤–∏—ó—Ö–∞–ª–∞ –¥–æ –ù—ñ–º–µ—á—á–∏–Ω–∏, –∞ —á–æ–ª–æ–≤—ñ–∫ –∑–∞–ª–∏—à–∏–≤—Å—è —Ç—É—Ç. –í–æ–Ω–∞ –¥—É–º–∞–ª–∞, —â–æ —Ç—Ä–µ–±–∞ —ó—Ö–∞—Ç–∏ –Ω–∞–∑–∞–¥ –¥–ª—è —Å—É–¥—ñ–≤. –ú–∏ –æ—Ä–≥–∞–Ω—ñ–∑—É–≤–∞–ª–∏ –≤—Å–µ –æ–Ω–ª–∞–π–Ω: –≤–æ–Ω–∞ –æ—Ñ–æ—Ä–º–∏–ª–∞ –¥–æ–≤—ñ—Ä–µ–Ω—ñ—Å—Ç—å –≤ –∫–æ–Ω—Å—É–ª—å—Å—Ç–≤—ñ, —ñ –º–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –∂–æ–¥–Ω–æ–≥–æ —ó—ó –≤—ñ–∑–∏—Ç—É –≤ –£–∫—Ä–∞—ó–Ω—É.</i>
""",
        """
<i>–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–π—Ç–∏ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å, –Ω–µ –≤—ñ–¥—Ä–∏–≤–∞—é—á–∏—Å—å –≤—ñ–¥ —Ä–æ–±–æ—Ç–∏ —á–∏ –∂–∏—Ç—Ç—è –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º.

–ù–∞—à –∫–ª—ñ—î–Ω—Ç –ú–∞–∫—Å–∏–º –ø—Ä–∞—Ü—é—î –≤ –ü–æ–ª—å—â—ñ. –í—ñ–Ω –Ω–µ –º—ñ–≥ –ø—Ä–∏—ó—Ö–∞—Ç–∏ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è. –ú–∏ –∑–≤'—è–∑–∞–ª–∏—Å—è —á–µ—Ä–µ–∑ –º–µ—Å–µ–Ω–¥–∂–µ—Ä, –ø—ñ–¥–≥–æ—Ç—É–≤–∞–ª–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏, —ñ –≤—ñ–Ω –æ—Ç—Ä–∏–º–∞–≤ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è, —Ñ—ñ–∑–∏—á–Ω–æ –∑–Ω–∞—Ö–æ–¥—è—á–∏—Å—å —É –ü–æ–∑–Ω–∞–Ω—ñ.</i>
"""
    ],
    
    # –î–ª—è —Ç–∏—Ö, —Ö—Ç–æ –ù–ï –ó–ù–ê–Ñ –î–ï –°–£–ü–†–£–ì
    'unknown_location': [
        """
<i>–¢–µ, —â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ –∞–¥—Ä–µ—Å–∏ –∞–±–æ —á–æ–ª–æ–≤—ñ–∫ –Ω–µ –≤–∏—Ö–æ–¥–∏—Ç—å –Ω–∞ –∑–≤'—è–∑–æ–∫ ‚Äî –Ω–µ –≥–ª—É—Ö–∏–π –∫—É—Ç.

–£ –Ω–∞—Å –±—É–ª–∞ —Å—Ö–æ–∂–∞ —Å–∏—Ç—É–∞—Ü—ñ—è –∑ –û–ª–µ–Ω–æ—é —ñ–∑ –ó–∞–ø–æ—Ä—ñ–∂–∂—è. –ß–æ–ª–æ–≤—ñ–∫ –ø–æ—ó—Ö–∞–≤ —ñ –∑–Ω–∏–∫. –ú–∏ –ø—Ä–æ–≤–µ–ª–∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—É "—Ä–æ–∑–ª—É—á–µ–Ω–Ω—è –∑–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ" —á–µ—Ä–µ–∑ –æ—Ñ—ñ—Ü—ñ–π–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è. –¶–µ –∑–∞–π–Ω—è–ª–æ —Ç—Ä–æ—Ö–∏ –±—ñ–ª—å—à–µ —á–∞—Å—É, –∞–ª–µ –û–ª–µ–Ω–∞ –æ—Ç—Ä–∏–º–∞–ª–∞ –æ—Ñ—ñ—Ü—ñ–π–Ω–µ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –π–æ–≥–æ —É—á–∞—Å—Ç—ñ.</i>
""",
        """
<i>–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥—Ä—É–≥–æ–≥–æ –∑ –ø–æ–¥—Ä—É–∂–∂—è –Ω–µ –ø–æ–∑–±–∞–≤–ª—è—î –≤–∞—Å –ø—Ä–∞–≤–∞ –Ω–∞ –Ω–æ–≤–µ –∂–∏—Ç—Ç—è.

–î–º–∏—Ç—Ä–æ –∑ –û–¥–µ—Å–∏ —Ç–µ–∂ –Ω–µ –∑–Ω–∞–≤, –¥–µ –∑–∞—Ä–∞–∑ –¥—Ä—É–∂–∏–Ω–∞. –ú–∏ –ø–æ–¥–∞–ª–∏ –ø–æ–∑–æ–≤ –∑–∞ —ó—ó –æ—Å—Ç–∞–Ω–Ω—å–æ—é –≤—ñ–¥–æ–º–æ—é –∞–¥—Ä–µ—Å–æ—é. –°—É–¥ –ø—Ä–∏–π–Ω—è–≤ —Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è –∑–∞–æ—á–Ω–æ. –¶–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –∑–∞–∫–æ–Ω–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞.</i>
"""
    ],
    
    # –ó–ê–ì–ê–õ–¨–ù–ò–ô
    'default': [
        """
<i>–ú–∏ —Ä–æ–∑—É–º—ñ—î–º–æ –≤–∞—à—ñ –ø–æ–±–æ—é–≤–∞–Ω–Ω—è. –ù–∞–π—á–∞—Å—Ç—ñ—à–∏–π —Å—Ç—Ä–∞—Ö –Ω–∞—à–∏—Ö –∫–ª—ñ—î–Ω—Ç—ñ–≤: "–Ø –∑—Ä–æ–±–ª—é –ø–æ–º–∏–ª–∫—É, —ñ —Ü–µ –∫–æ—à—Ç—É–≤–∞—Ç–∏–º–µ –º–µ–Ω—ñ –≥—Ä–æ—à–µ–π –∞–±–æ –Ω–µ—Ä–≤—ñ–≤".

–ù–∞—à–∞ –ø–µ—Ä—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –¥–∞—Ç–∏ –≤–∞–º <b>—á—ñ—Ç–∫–∏–π, –ø–æ–∫—Ä–æ–∫–æ–≤–∏–π –ø–ª–∞–Ω –¥—ñ–π.</b> –ö–æ–ª–∏ –≤–∏ –±–∞—á–∏—Ç–µ —à–ª—è—Ö —ñ —Ä–æ–∑—É–º—ñ—î—Ç–µ —Å–≤–æ—ó –ø—Ä–∞–≤–∞, 90% —Å—Ç—Ä–µ—Å—É –∑–Ω–∏–∫–∞—î –º–∏—Ç—Ç—î–≤–æ.</i>
"""
    ]
}

def get_mini_case(user_data):
    """–í–∏–±–∏—Ä–∞—î —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–π –¥–µ—Ç–∞–ª—å–Ω–∏–π –º–∏–Ω—ñ-–∫–µ–π—Å"""
    
    has_children = user_data.get('has_children') == 'yes'
    spouse_consent = user_data.get('spouse_consent')
    property_dispute = user_data.get('property_dispute')
    spouse_location = user_data.get('spouse_location')
    
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 1: –ó–∞ –∫–æ—Ä–¥–æ–Ω–æ–º
    if spouse_location == 'abroad':
        cases = MINI_CASES['abroad']
        
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 2: –ù–µ–≤—ñ–¥–æ–º–µ –º—ñ—Å—Ü–µ
    elif spouse_location == 'unknown':
        cases = MINI_CASES['unknown_location']
        
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 3: –Ñ –º–∞–π–Ω–æ
    elif property_dispute == 'yes':
        cases = MINI_CASES['yes_property']
        
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 4: –Ñ –¥—ñ—Ç–∏ + –Ω–µ–º–∞—î –∑–≥–æ–¥–∏
    elif has_children and spouse_consent == 'no':
        cases = MINI_CASES['yes_children_no_consent']
        
    # –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç 5: –ù–µ–º–∞—î –¥—ñ—Ç–µ–π + —î –∑–≥–æ–¥–∞
    elif not has_children and spouse_consent == 'yes':
        cases = MINI_CASES['no_children_yes_consent']
        
    # –î–µ—Ñ–æ–ª—Ç–Ω–∏–π
    else:
        cases = MINI_CASES['default']
    
    return random.choice(cases)

# =====================================================
# –ü–û–ö–†–ê–©–ï–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò –î–õ–Ø 10 –°–ï–ì–ú–ï–ù–¢–Ü–í
# =====================================================

SEGMENT_MESSAGES = {
    'A1': """
‚ö°Ô∏è <b>{segment_name}</b>

–í—ñ–¥–º—ñ–Ω–Ω–∞ –Ω–æ–≤–∏–Ω–∞! –£ –≤–∞—Å –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∞ —Å–∏—Ç—É–∞—Ü—ñ—è - –º–æ–∂–µ–º–æ —Ä–æ–∑–ª—É—á–∏—Ç–∏ —à–≤–∏–¥–∫–æ —ñ –±–µ–∑ –∑–∞–π–≤–∏—Ö –≤–∏—Ç—Ä–∞—Ç.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–ß–æ–º—É —Å–∞–º–µ —Ç–∞–∫:</b>
‚Ä¢ –ù–µ–º–∞—î –¥—ñ—Ç–µ–π ‚Üí –Ω–µ–º–∞—î –ø–∏—Ç–∞–Ω—å –ø—Ä–æ –æ–ø—ñ–∫—É
‚Ä¢ –°—É–ø—Ä—É–≥/–∞ –∑–≥–æ–¥–Ω—ñ ‚Üí –Ω–µ –±—É–¥–µ –∑–∞—Ç—è–≥—É–≤–∞–Ω—å
‚Ä¢ –ù–µ–º–∞—î —Å–ø–æ—Ä—ñ–≤ –ø—Ä–æ –º–∞–π–Ω–æ ‚Üí –≤—Å–µ –ø—Ä–æ—Å—Ç–æ
‚Ä¢ –í–∏ —Ö–æ—á–µ—Ç–µ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ ‚Üí –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç

<b>–©–æ –≤—Ö–æ–¥–∏—Ç—å:</b>
‚úÖ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–∑–æ–≤–Ω–æ—ó –∑–∞—è–≤–∏ –∑–∞ 1 –¥–µ–Ω—å
‚úÖ –ü–æ–¥–∞–Ω–Ω—è –¥–æ —Å—É–¥—É
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏—Ü—Ç–≤–æ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—ñ (–º–æ–∂–µ—Ç–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏)
‚úÖ –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä—ñ—à–µ–Ω–Ω—è —Å—É–¥—É

<i>–¶–µ –≤–∞—à "–∑–µ–ª–µ–Ω–∏–π –∫–æ—Ä–∏–¥–æ—Ä" - –Ω–∞–π—à–≤–∏–¥—à–∏–π —Å–ø–æ—Å—ñ–± —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è.</i>
""",

    'A2': """
‚úÖ <b>{segment_name}</b>

–•–æ—Ä–æ—à—ñ –Ω–æ–≤–∏–Ω–∏! –í–∞—à–∞ —Å–∏—Ç—É–∞—Ü—ñ—è —Ü—ñ–ª–∫–æ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —ñ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤–∞–Ω–∞.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ –≤–∞—à–æ–≥–æ –≤–∏–ø–∞–¥–∫—É:</b>
‚Ä¢ –ù–µ–º–∞—î –¥—ñ—Ç–µ–π ‚Üí —Å–ø—Ä–æ—â–µ–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞
‚Ä¢ –Ñ –∑–≥–æ–¥–∞ —Å—É–ø—Ä—É–≥–∞ ‚Üí —à–≤–∏–¥—à–µ
‚Ä¢ –ú–∞–π–Ω–æ –≤—Ä–µ–≥—É–ª—å–æ–≤–∞–Ω–æ –∞–±–æ –π–æ–≥–æ –º–∞–ª–æ

<b>–©–æ –≤—Ö–æ–¥–∏—Ç—å:</b>
‚úÖ –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è "–ø—ñ–¥ –∫–ª—é—á"
‚úÖ –ü–æ–¥–∞–Ω–Ω—è –¥–æ —Å—É–¥—É
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏—Ü—Ç–≤–æ –Ω–∞ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è—Ö
‚úÖ –†—ñ—à–µ–Ω–Ω—è —Å—É–¥—É –Ω–∞ —Ä—É–∫–∏

<i>–û—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î —Å–∫–ª–∞–¥–Ω–æ—â—ñ–≤, –ø—Ä–æ—Ü–µ—Å –ø—Ä–æ–π–¥–µ —Å–ø–æ–∫—ñ–π–Ω–æ —ñ –±–µ–∑ —Å—Ç—Ä–µ—Å—É.</i>
""",

    'B1': """
üõ° <b>{segment_name}</b>

–†–æ–∑—É–º—ñ—é, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ü–µ —Å–∫–ª–∞–¥–Ω–æ. –ê–ª–µ —É –Ω–∞—Å –≤–µ–ª–∏–∫–∏–π –¥–æ—Å–≤—ñ–¥ —Å–∞–º–µ —Ç–∞–∫–∏—Ö —Å–ø—Ä–∞–≤.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–ß–æ–º—É –ø–æ—Ç—Ä—ñ–±–µ–Ω –∞–¥–≤–æ–∫–∞—Ç —Å–∞–º–µ —Ç—É—Ç:</b>
‚Ä¢ –Ñ –¥—ñ—Ç–∏ ‚Üí —Ç—Ä–µ–±–∞ –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –º—ñ—Å—Ü–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è
‚Ä¢ –°—É–ø—Ä—É–≥ –ø—Ä–æ—Ç–∏ ‚Üí –ø–æ—Ç—Ä—ñ–±–Ω–∞ —á—ñ—Ç–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è
‚Ä¢ –í–∞–∂–ª–∏–≤–æ –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –ø—Ä–∞–≤–∞ –¥–∏—Ç–∏–Ω–∏

<b>–©–æ –º–∏ —Ä–æ–±–∏–º–æ:</b>
‚úÖ –°–∫–ª–∞–¥–∞—î–º–æ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é –∑–∞—Ö–∏—Å—Ç—É –≤–∞—à–∏—Ö —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤
‚úÖ –ì–æ—Ç—É—î–º–æ –¥–æ–∫–∞–∑–∏ –≤–∞—à–æ—ó –ø—Ä–∏—Ö–∏–ª—å–Ω–æ—Å—Ç—ñ –¥–æ –¥–∏—Ç–∏–Ω–∏
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î–º–æ —ñ–Ω—Ç–µ—Ä–µ—Å–∏ –Ω–∞ –≤—Å—ñ—Ö –∑–∞—Å—ñ–¥–∞–Ω–Ω—è—Ö
‚úÖ –î–æ–º–∞–≥–∞—î–º–æ—Å—è —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫–∞ –∑—É—Å—Ç—Ä—ñ—á–µ–π
‚úÖ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–ª—ñ–º–µ–Ω—Ç—ñ–≤

<i>–ì–æ–ª–æ–≤–Ω–µ - –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏ –¥–∏—Ç–∏–Ω—É –≤—ñ–¥ —Å—Ç—Ä–µ—Å—É —ñ –∑–±–µ—Ä–µ–≥—Ç–∏ –≤–∞—à –∑–≤'—è–∑–æ–∫ –∑ –Ω–µ—é. –£ –Ω–∞—Å —Ü–µ –≤–∏—Ö–æ–¥–∏—Ç—å.</i>
""",

    'B2': """
üë®‚Äçüë©‚Äçüëß <b>{segment_name}</b>

–î—É–∂–µ –¥–æ–±—Ä–µ, —â–æ –≤–∏ –¥–æ–º–æ–≤–∏–ª–∏—Å—è. –¶–µ –Ω–∞–π–∫—Ä–∞—â–µ –¥–ª—è –¥–∏—Ç–∏–Ω–∏.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–í–∞—à–∞ —Å–∏—Ç—É–∞—Ü—ñ—è:</b>
‚Ä¢ –Ñ –¥—ñ—Ç–∏, –∞–ª–µ –≤–∏ –¥–æ–º–æ–≤–∏–ª–∏—Å—è –ø—Ä–æ –æ–ø—ñ–∫—É
‚Ä¢ –û–±–∏–¥–≤–∞ —Ö–æ—á–µ—Ç–µ —à–≤–∏–¥–∫–æ —ñ –±–µ–∑ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤
‚Ä¢ –ü–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ñ–æ—Ä–º–∏—Ç–∏ –≤—Å–µ —é—Ä–∏–¥–∏—á–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

<b>–©–æ –º–∏ –∑—Ä–æ–±–∏–º–æ:</b>
‚úÖ –û—Ñ–æ—Ä–º–∏–º–æ —É–≥–æ–¥—É –ø—Ä–æ –º—ñ—Å—Ü–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è –¥–∏—Ç–∏–Ω–∏
‚úÖ –ó–∞—Ñ—ñ–∫—Å—É—î–º–æ –¥–æ–º–æ–≤–ª–µ–Ω–æ—Å—Ç—ñ –ø—Ä–æ –∞–ª—ñ–º–µ–Ω—Ç–∏
‚úÖ –ü–æ–¥–∞–º–æ –≤—Å–µ –¥–æ —Å—É–¥—É –æ–¥–Ω–∏–º –ø–∞–∫–µ—Ç–æ–º
‚úÖ –ü—Ä–æ–≤–µ–¥–µ–º–æ —á–µ—Ä–µ–∑ —Å—É–¥ —à–≤–∏–¥–∫–æ

<i>–û—Å–∫—ñ–ª—å–∫–∏ —î –∑–≥–æ–¥–∞, –ø—Ä–æ—Ü–µ—Å –±—É–¥–µ –Ω–∞–±–∞–≥–∞—Ç–æ —à–≤–∏–¥—à–∏–º. –ì–æ–ª–æ–≤–Ω–µ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Å–µ –æ—Ñ–æ—Ä–º–∏—Ç–∏.</i>
""",

    'C1': """
üíº <b>{segment_name}</b>

–í–∞—à –≤–∏–ø–∞–¥–æ–∫ –≤–∏–º–∞–≥–∞—î –≤–∏—Å–æ–∫–æ—ó –∫–≤–∞–ª—ñ—Ñ—ñ–∫–∞—Ü—ñ—ó. –¶–µ —Å–µ—Ä–π–æ–∑–Ω–∞ —Ä–æ–±–æ—Ç–∞.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–ß–æ–º—É —Ü–µ —Å–∫–ª–∞–¥–Ω–æ:</b>
‚Ä¢ –ë–∞–≥–∞—Ç–æ —Å–ø—ñ–ª—å–Ω–æ–≥–æ –º–∞–π–Ω–∞ ‚Üí –ø–æ—Ç—Ä—ñ–±–Ω–∞ –æ—Ü—ñ–Ω–∫–∞
‚Ä¢ –Ñ –¥—ñ—Ç–∏ ‚Üí –ø–æ–¥–≤—ñ–π–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å
‚Ä¢ –ú–æ–∂–ª–∏–≤—ñ —Å–ø—Ä–æ–±–∏ –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–∏

<b>–ù–∞—à–∞ —Ä–æ–±–æ—Ç–∞:</b>
‚úÖ –ü–æ–≤–Ω–∏–π –∞—É–¥–∏—Ç —Å–ø—ñ–ª—å–Ω–æ–≥–æ –º–∞–π–Ω–∞
‚úÖ –ó–∞–ª—É—á–µ–Ω–Ω—è –µ–∫—Å–ø–µ—Ä—Ç—ñ–≤-–æ—Ü—ñ–Ω—é–≤–∞—á—ñ–≤
‚úÖ –í–∏—è–≤–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –∞–∫—Ç–∏–≤—ñ–≤
‚úÖ –†–æ–∑—Ä–æ–±–∫–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏—Ü—Ç–≤–æ –Ω–∞ –≤—Å—ñ—Ö –∑–∞—Å—ñ–¥–∞–Ω–Ω—è—Ö
‚úÖ –ó–∞—Ö–∏—Å—Ç —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤ –¥–∏—Ç–∏–Ω–∏

<i>–ë–µ–∑ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ –∞–¥–≤–æ–∫–∞—Ç–∞ –º–æ–∂–Ω–∞ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ –∑–Ω–∞—á–Ω—É —á–∞—Å—Ç–∏–Ω—É –∞–∫—Ç–∏–≤—ñ–≤. –ú–∏ —Ü—å–æ–≥–æ –Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ.</i>
""",

    'C2': """
üí∞ <b>{segment_name}</b>

–ú–∞—î—Ç–µ —Å–ø—ñ–ª—å–Ω–µ –º–∞–π–Ω–æ - —Ü–µ –≤–∏–º–∞–≥–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</b>
‚Ä¢ –Ñ —Å–ø—ñ–ª—å–Ω–µ –º–∞–π–Ω–æ –¥–ª—è —Ä–æ–∑–¥—ñ–ª—É
‚Ä¢ –ü–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ü—ñ–Ω–∏—Ç–∏ —ñ —Ä–æ–∑–ø–æ–¥—ñ–ª–∏—Ç–∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ
‚Ä¢ –í–∞–∂–ª–∏–≤–æ –Ω–µ –≤—Ç—Ä–∞—Ç–∏—Ç–∏ —Å–≤–æ—î

<b>–©–æ –≤—Ö–æ–¥–∏—Ç—å:</b>
‚úÖ –Ü–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü—ñ—è —Å–ø—ñ–ª—å–Ω–æ–≥–æ –º–∞–π–Ω–∞
‚úÖ –û—Ü—ñ–Ω–∫–∞ –≤–∞—Ä—Ç–æ—Å—Ç—ñ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)
‚úÖ –ü–æ—à—É–∫ –∫–æ–º–ø—Ä–æ–º—ñ—Å–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏—Ü—Ç–≤–æ –≤ —Å—É–¥—ñ
‚úÖ –ó–∞—Ö–∏—Å—Ç –≤–∞—à–∏—Ö —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤

<i>–†–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞ - –∑–∞–≤–∂–¥–∏ –¥–µ–ª—ñ–∫–∞—Ç–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è. –ú–∏ –∑–Ω–∞—î–º–æ —è–∫ –¥–æ–º–æ–≤–∏—Ç–∏—Å—è –∞–±–æ –≤—ñ–¥—Å—Ç–æ—è—Ç–∏ –≤–∞—à—É –ø–æ–∑–∏—Ü—ñ—é –≤ —Å—É–¥—ñ.</i>
""",

    'D1': """
üåç <b>{segment_name}</b>

–í—ñ–¥—Å—Ç–∞–Ω—å - –Ω–µ –ø–µ—Ä–µ—à–∫–æ–¥–∞. –í–∏ —Ö–æ—á–µ—Ç–µ —à–≤–∏–¥–∫–æ - –º–∏ –æ—Ä–≥–∞–Ω—ñ–∑—É—î–º–æ.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–í–∞—à–∞ —Å–∏—Ç—É–∞—Ü—ñ—è:</b>
‚Ä¢ –û–¥–∏–Ω –∑ –ø–æ–¥—Ä—É–∂–∂—è –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º
‚Ä¢ –ü–æ—Ç—Ä—ñ–±–Ω–æ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ
‚Ä¢ –•–æ—á–µ—Ç–µ VIP-—Ä—ñ–≤–µ–Ω—å —Å–µ—Ä–≤—ñ—Å—É

<b>–©–æ –º–∏ —Ä–æ–±–∏–º–æ:</b>
‚úÖ –ü–æ–≤–Ω–∞ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ü–µ—Å—É –æ–Ω–ª–∞–π–Ω
‚úÖ –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ–≤—ñ—Ä–µ–Ω–æ—Å—Ç—ñ (–∫–æ–Ω—Å—É–ª—å—Ç—É—î–º–æ —è–∫ –æ—Ñ–æ—Ä–º–∏—Ç–∏)
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–Ω–∏—Ü—Ç–≤–æ –±–µ–∑ –≤–∞—à–æ—ó –ø—Ä–∏—Å—É—Ç–Ω–æ—Å—Ç—ñ
‚úÖ –í—Å—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ—à—Ç–æ—é –∑–∞ –∫–æ—Ä–¥–æ–Ω
‚úÖ –ü–æ—Å—Ç—ñ–π–Ω–∞ –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è (Telegram/WhatsApp)
‚úÖ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–π —Ä–æ–∑–≥–ª—è–¥

<i>–í–∏ –º–æ–∂–µ—Ç–µ –±—É—Ç–∏ –≤ –±—É–¥—å-—è–∫—ñ–π –∫—Ä–∞—ó–Ω—ñ - –º–∏ –≤—Å–µ –∑—Ä–æ–±–∏–º–æ –∑–∞ –≤–∞—Å. –ù–∞–≤—ñ—Ç—å –Ω–µ —Ç—Ä–µ–±–∞ –ø—Ä–∏—ó–∂–¥–∂–∞—Ç–∏.</i>
""",

    'D2': """
üåç <b>{segment_name}</b>

–ü–µ—Ä–µ–±—É–≤–∞—î—Ç–µ –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º? –ù–µ –ø—Ä–æ–±–ª–µ–º–∞ - –æ—Ä–≥–∞–Ω—ñ–∑—É—î–º–æ –≤—Å–µ –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–û—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:</b>
‚Ä¢ –û–¥–∏–Ω/–æ–±–∏–¥–≤–∞ –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º
‚Ä¢ –†–æ–∑–ª—É—á–µ–Ω–Ω—è –±–µ–∑ –ø—Ä–∏—ó–∑–¥—É –≤ –£–∫—Ä–∞—ó–Ω—É
‚Ä¢ –í—Å—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –æ–Ω–ª–∞–π–Ω

<b>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:</b>
‚úÖ –í–∏ –æ—Ñ–æ—Ä–º–ª—è—î—Ç–µ –¥–æ–≤—ñ—Ä–µ–Ω—ñ—Å—Ç—å –≤ –∫–æ–Ω—Å—É–ª—å—Å—Ç–≤—ñ
‚úÖ –ù–∞–¥—Å–∏–ª–∞—î—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø–æ—à—Ç–æ—é/—Å–∫–∞–Ω-–∫–æ–ø—ñ—è–º–∏
‚úÖ –ú–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î–º–æ –≤–∞—à—ñ —ñ–Ω—Ç–µ—Ä–µ—Å–∏ –≤ —Å—É–¥—ñ
‚úÖ –†—ñ—à–µ–Ω–Ω—è —Å—É–¥—É –æ—Ç—Ä–∏–º—É—î—Ç–µ –ø–æ—à—Ç–æ—é –∑–∞ –∫–æ—Ä–¥–æ–Ω
‚úÖ –í–µ—Å—å –ø—Ä–æ—Ü–µ—Å - —á–µ—Ä–µ–∑ –º–µ—Å–µ–Ω–¥–∂–µ—Ä–∏

<i>–¢–∏—Å—è—á—ñ —É–∫—Ä–∞—ó–Ω—Ü—ñ–≤ —Ä–æ–∑–ª—É—á–∏–ª–∏—Å—è –±—É–¥—É—á–∏ –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º. –¶–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –¥–ª—è –Ω–∞—Å.</i>
""",

    'E1': """
üîç <b>{segment_name}</b>

–ù–µ –∑–Ω–∞—î—Ç–µ –¥–µ —Å—É–ø—Ä—É–≥/–∞ - —Ü–µ –Ω–µ –ø–µ—Ä–µ—à–∫–æ–¥–∞ –¥–ª—è —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–ß–æ–º—É —Ü–µ –º–æ–∂–ª–∏–≤–æ:</b>
‚Ä¢ –ó–∞–∫–æ–Ω –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è "–∑–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ"
‚Ä¢ –ß–µ—Ä–µ–∑ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –≤ –ø—Ä–µ—Å—ñ —Ç–∞ –Ω–∞ —Å–∞–π—Ç—ñ —Å—É–¥—É
‚Ä¢ –ü—Ä–æ—Ü–µ—Å —Ç—Ä–∏–≤–∞—î –¥–æ–≤—à–µ, –∞–ª–µ –≤—ñ–Ω –ª–µ–≥–∞–ª—å–Ω–∏–π

<b>–©–æ –º–∏ —Ä–æ–±–∏–º–æ:</b>
‚úÖ –ü—É–±–ª—ñ–∫—É—î–º–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –ø—Ä–æ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è
‚úÖ –ù–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ–≤—ñ—Å—Ç–∫–∏ –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—é –∞–¥—Ä–µ—Å—É
‚úÖ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î–º–æ –≤–∞—à—ñ —ñ–Ω—Ç–µ—Ä–µ—Å–∏ –≤ —Å—É–¥—ñ
‚úÖ –î–æ–≤–æ–¥–∏–º–æ, —â–æ –≤–∏ –Ω–∞–º–∞–≥–∞–ª–∏—Å—è –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏ —Å—É–ø—Ä—É–≥–∞
‚úÖ –û—Ç—Ä–∏–º—É—î–º–æ —Ä—ñ—à–µ–Ω–Ω—è —Å—É–¥—É

<i>–ù–∞–≤—ñ—Ç—å —è–∫—â–æ —Å—É–ø—Ä—É–≥/–∞ –ø—Ä–æ–ø–∞–≤/–ª–∞ –±–µ–∑–≤—ñ—Å—Ç–∏ - –≤–∏ –º–∞—î—Ç–µ –ø—Ä–∞–≤–æ –Ω–∞ –Ω–æ–≤–µ –∂–∏—Ç—Ç—è. –î–æ–ø–æ–º–æ–∂–µ–º–æ.</i>
""",

    'E2': """
üîç <b>{segment_name}</b>

–°—É–ø—Ä—É–≥ –ø—Ä–æ—Ç–∏ —ñ –º–æ–∂–µ —É–Ω–∏–∫–∞—Ç–∏ - –∑–Ω–∞—î–º–æ —è–∫ –∑ —Ü–∏–º –ø—Ä–∞—Ü—é–≤–∞—Ç–∏.

üí∞ <b>–í–∞—Ä—Ç—ñ—Å—Ç—å:</b> {cost}
‚è± <b>–°—Ç—Ä–æ–∫–∏:</b> {time}

<b>–í–∞—à–∞ —Å–∏—Ç—É–∞—Ü—ñ—è:</b>
‚Ä¢ –°—É–ø—Ä—É–≥ –ø—Ä–æ—Ç–∏ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—è
‚Ä¢ –ù–µ –∑–Ω–∞—î—Ç–µ –¥–µ –≤—ñ–Ω –∑–∞—Ä–∞–∑ / –º–æ–∂–µ —Ö–æ–≤–∞—Ç–∏—Å—è
‚Ä¢ –ë–æ—ó—Ç–µ—Å—è —â–æ –ø—Ä–æ—Ü–µ—Å –∑–∞—Ç—è–≥–Ω–µ—Ç—å—Å—è

<b>–ù–∞—à–∞ —Ç–∞–∫—Ç–∏–∫–∞:</b>
‚úÖ –°–ø—Ä–æ–±–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è
‚úÖ –û—Ñ—ñ—Ü—ñ–π–Ω—ñ –∑–∞–ø–∏—Ç–∏ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ—é –∞–¥—Ä–µ—Å–æ—é
‚úÖ –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è –æ–≥–æ–ª–æ—à–µ–Ω—å
‚úÖ –°—É–¥–æ–≤—ñ –∑–∞—Å—ñ–¥–∞–Ω–Ω—è "–∑–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ"
‚úÖ –ó–∞—Ö–∏—Å—Ç –≤–∞—à–∏—Ö —ñ–Ω—Ç–µ—Ä–µ—Å—ñ–≤

<i>–í–∞–∂–ª–∏–≤–æ: —Å—É–¥ –Ω–µ –º–æ–∂–µ –≤—ñ–¥–º–æ–≤–∏—Ç–∏ –≤–∞–º —É —Ä–æ–∑–ª—É—á–µ–Ω–Ω—ñ —á–µ—Ä–µ–∑ —Ç–µ, —â–æ —Å—É–ø—Ä—É–≥ —Ö–æ–≤–∞—î—Ç—å—Å—è. –ú–∏ —Ü–µ –∑–Ω–∞—î–º–æ —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ.</i>
"""
}

# –ó–ê–ú–Ü–ù–ò –¶–Æ –§–£–ù–ö–¶–Ü–Æ –ü–û–í–ù–Ü–°–¢–Æ
def get_personalized_offer(first_name, segment_name):
    """–ì–µ–Ω–µ—Ä—É—î –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ—Ñ—Ñ–µ—Ä (–ë–µ–∑ '3 —Å–ª–æ—Ç—ñ–≤')"""
    
    # –í–∏–¥–∞–ª—è—î–º–æ –µ–º–æ–¥–∑—ñ, —è–∫—â–æ –≤—ñ–Ω —î –≤ –Ω–∞–∑–≤—ñ —Å–µ–≥–º–µ–Ω—Ç—É
    cleaned_segment_name = segment_name.split(' ', 1)[-1]
    
    return f"""
üéÅ <b>{first_name}, –£ –ú–ï–ù–ï –î–õ–Ø –í–ê–° –°–ü–ï–¶–Ü–ê–õ–¨–ù–ê –ü–†–û–ü–û–ó–ò–¶–Ü–Ø</b>

–í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ "–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é". –í–∏ –∫—É–ø—É—î—Ç–µ <b>—Ä–µ–∑—É–ª—å—Ç–∞—Ç: –ø–æ–≤–Ω—É —è—Å–Ω—ñ—Å—Ç—å —ñ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü—ñ—î—é.</b>

–ó–∞–∑–≤–∏—á–∞–π —Ä–æ–∑—Ä–æ–±–∫–∞ —Ç–∞–∫–æ–≥–æ –ø–æ–∫—Ä–æ–∫–æ–≤–æ–≥–æ –ø–ª–∞–Ω—É –∫–æ—à—Ç—É—î 2000 –≥—Ä–Ω.

–ê–ª–µ –¥–ª—è —Ç–∏—Ö, —Ö—Ç–æ –ø—Ä–æ–π—à–æ–≤ —Ü–µ–π —Ç–µ—Å—Ç, —Ü—ñ–Ω–∞ ‚Äî <b>–≤—Å—å–æ–≥–æ 990 –≥—Ä–Ω.</b>
–¶—è —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è **–¥—ñ—î –ª–∏—à–µ –¥–æ –∫—ñ–Ω—Ü—è —Ü—å–æ–≥–æ —Ç–∏–∂–Ω—è**.

<b>–©–û –ö–û–ù–ö–†–ï–¢–ù–û –í–ò –û–¢–†–ò–ú–ê–Ñ–¢–ï (–†–ï–ó–£–õ–¨–¢–ê–¢–ò):</b>

<b>‚úÖ 1. –ü–û–í–ù–ê –Ø–°–ù–Ü–°–¢–¨</b>
–ú–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–º–æ –≤–∞—à "—Ö–∞–æ—Å" —ñ –ø–∞–Ω—ñ–∫—É –Ω–∞ —á—ñ—Ç–∫–∏–π, –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –ø—Ä–æ—Ü–µ—Å. –í–∏ –±—É–¥–µ—Ç–µ —Ç–æ—á–Ω–æ –∑–Ω–∞—Ç–∏, —â–æ, —è–∫ —ñ –≤ —è–∫–æ–º—É –ø–æ—Ä—è–¥–∫—É —Ä–æ–±–∏—Ç–∏.

<b>‚úÖ 2. –ü–û–ö–†–û–ö–û–í–ò–ô –ü–õ–ê–ù (–ø—ñ–¥ –≤–∞—à –≤–∏–ø–∞–¥–æ–∫)</b>
–í–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É "–¥–æ—Ä–æ–∂–Ω—é –∫–∞—Ä—Ç—É" —Å–∞–º–µ –¥–ª—è –≤–∞—à–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó (<b>{cleaned_segment_name}</b>), —è–∫–∞ –∫—Ä–æ–∫ –∑–∞ –∫—Ä–æ–∫–æ–º –ø—Ä–∏–≤–µ–¥–µ –≤–∞—Å –¥–æ –º–µ—Ç–∏.

<b>‚úÖ 3. –ó–ê–•–ò–°–¢ –í–Ü–î –ü–û–ú–ò–õ–û–ö</b>
–ú–∏ –ø–æ–∫–∞–∂–µ–º–æ, –¥–µ 90% –ª—é–¥–µ–π –≤—Ç—Ä–∞—á–∞—é—Ç—å –≥—Ä–æ—à—ñ —Ç–∞ —á–∞—Å. –í–∏ —É–Ω–∏–∫–Ω–µ—Ç–µ —Ü–∏—Ö –ø–æ–º–∏–ª–æ–∫ —ñ –∑–±–µ—Ä–µ–∂–µ—Ç–µ —Å–≤–æ—ó –∞–∫—Ç–∏–≤–∏, –Ω–µ—Ä–≤–∏ —Ç–∞ —Å—Ç–æ—Å—É–Ω–∫–∏ –∑ –¥—ñ—Ç—å–º–∏.

<b>‚úÖ 4. –ö–û–ù–¢–†–û–õ–¨ –ù–ê–î –°–ò–¢–£–ê–¶–Ü–Ñ–Æ</b>
–ù–∞–π–≥–æ–ª–æ–≤–Ω—ñ—à–µ. –°—Ç—Ä–∞—Ö —ñ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ—Å—Ç—å –∑–Ω–∏–∫–Ω—É—Ç—å. –í–∏ –ø—ñ–¥–µ—Ç–µ –∑ —Ä–æ–∑–º–æ–≤–∏ –∑ –≤—ñ–¥—á—É—Ç—Ç—è–º –≤–ø–µ–≤–Ω–µ–Ω–æ—Å—Ç—ñ —Ç–∞ –ø–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—é –Ω–∞–¥ —Å–≤–æ—ó–º –∂–∏—Ç—Ç—è–º.

<b>üéØ –ù–ê–ô–ì–û–õ–û–í–ù–Ü–®–ï:</b>
–Ø–∫—â–æ –ø—ñ—Å–ª—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó –≤–∏ –≤–∏—Ä—ñ—à–∏—Ç–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –Ω–∞–º–∏ - —Ü—ñ 990 –≥—Ä–Ω <b>–ü–û–í–ù–Ü–°–¢–Æ –ó–ê–†–ê–•–û–í–£–Æ–¢–¨–°–Ø</b> –≤ –æ–ø–ª–∞—Ç—É –æ—Å–Ω–æ–≤–Ω–æ—ó –ø–æ—Å–ª—É–≥–∏!

<i>–¢–æ–±—Ç–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è —Ñ–∞–∫—Ç–∏—á–Ω–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞, —è–∫—â–æ –≤–∏ —Å—Ç–∞–Ω–µ—Ç–µ –∫–ª—ñ—î–Ω—Ç–æ–º.</i>
"""

# üìù –¢–ï–ö–°–¢: –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑–∞–ø–∏—Å—É (–ü–û–ö–†–ê–©–ï–ù–û)
def get_consultation_booked_text(first_name, phone):
    """–ì–µ–Ω–µ—Ä—É—î —Ç–µ–∫—Å—Ç –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑ –∫–æ–Ω—Ñ–µ—Ç—ñ"""
    return f"""
‚úÖ <b>–ß—É–¥–æ–≤–æ, {first_name}!</b>

–í–∞—à –∑–∞–ø–∏—Ç –ø—Ä–∏–π–Ω—è—Ç–æ.

–ù–∞—à –ø–æ–º—ñ—á–Ω–∏–∫ –∞–¥–≤–æ–∫–∞—Ç–∞ <b>–∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –≤–∞–º–∏ –ø—Ä–æ—Ç—è–≥–æ–º 5-15 —Ö–≤–∏–ª–∏–Ω</b>, —â–æ–± —É–∑–≥–æ–¥–∏—Ç–∏ –∑—Ä—É—á–Ω–∏–π —á–∞—Å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó.

<i>–û—á—ñ–∫—É–π—Ç–µ –¥–∑–≤—ñ–Ω–æ–∫ –Ω–∞ –Ω–æ–º–µ—Ä:</i> <code>{phone}</code>

–Ø–∫—â–æ –Ω–µ –∑–º–æ–∂–µ–º–æ –¥–æ—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞—Ç–∏—Å—å, –Ω–∞–ø–∏—à–µ–º–æ –≤–∞–º —Å—é–¥–∏ –≤ Telegram.

<b>–î—è–∫—É—î–º–æ –∑–∞ –¥–æ–≤—ñ—Ä—É!</b> üôè

<i>P.S. –ü—ñ–¥–≥–æ—Ç—É–π—Ç–µ—Å—è –¥–æ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó: –ø–æ–¥—É–º–∞–π—Ç–µ —è–∫—ñ –ø–∏—Ç–∞–Ω–Ω—è —Ö–æ—á–µ—Ç–µ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ —ñ —è–∫—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –º–∞—î—Ç–µ –ø—ñ–¥ —Ä—É–∫–æ—é.</i>
"""

# üìù –Ü–ù–®–Ü –¢–ï–ö–°–¢–ò (–Ω–µ–∑–º—ñ–Ω–Ω—ñ)
TEXT_UNKNOWN_MESSAGE = "–í–∏–±–∞—á—Ç–µ, –Ω–µ —Ä–æ–∑—É–º—ñ—é ü§î\n\n–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å /start, —â–æ–± –ø–æ—á–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫."

TEXT_PHONE_REMINDER = """
üëã –ó–¥–∞—î—Ç—å—Å—è, –≤–∏ –Ω–µ –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ –∫–Ω–æ–ø–∫—É...

–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫, –±—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´üì± –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –Ω–æ–º–µ—Ä–æ–º¬ª.

–¶–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–ø–µ—á–Ω–æ —ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ª–∏—à–µ –¥–ª—è —Ç–æ–≥–æ, —â–æ–± –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –≤–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
"""

TEXT_QUIZ_REMINDER = """
üëã –ó–¥–∞—î—Ç—å—Å—è, –≤–∏ –≤—ñ–¥–≤–æ–ª—ñ–∫–ª–∏—Å—è...

–ú–∏ –∑—É–ø–∏–Ω–∏–ª–∏—Å—è –Ω–∞ –ø—ñ–≤–¥–æ—Ä–æ–∑—ñ –¥–æ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É –≤–∞—Ä—Ç–æ—Å—Ç—ñ. –ë–∞–∂–∞—î—Ç–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏?

–ü—Ä–æ—Å—Ç–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å /start, —â–æ–± –ø–æ—á–∞—Ç–∏ –∑–∞–Ω–æ–≤–æ (—Ü–µ —à–≤–∏–¥–∫–æ!), –∞–±–æ –¥–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—î –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, —è–∫—â–æ –≤–æ–Ω–æ —â–µ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ.
"""

# =====================================================
# –û–ë–†–û–ë–ù–ò–ö–ò –ö–û–ú–ê–ù–î
# =====================================================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ /start"""
    
    user = update.effective_user

    await remove_quiz_reminder(context, user.id)
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤ –±–∞–∑—É "All Users"
    await save_all_user(
        telegram_id=user.id,
        username=user.username,
        first_name=user.first_name,
        last_name=user.last_name
    )
    
    await log_event(user.id, user.username, "/start", "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—á–∞–≤ –≤–∑–∞—î–º–æ–¥—ñ—é")
    
    # –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –¥–∞–Ω—ñ
    context.user_data.clear()
    context.user_data['telegram_id'] = user.id
    context.user_data['username'] = user.username or ''
    context.user_data['started_at'] = datetime.now().isoformat()
    
    keyboard = [[InlineKeyboardButton("‚úÖ –¢–∞–∫, –ø–æ—á–Ω–µ–º–æ!", callback_data='start_quiz')]]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        TEXT_WELCOME,
        parse_mode='HTML',
        reply_markup=reply_markup
    )

# =====================================================
# –û–ë–†–û–ë–ù–ò–ö–ò –ö–í–Ü–ó–£ (–ü–û–ö–†–ê–©–ï–ù–Ü –ó –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–ê–ú–ò)
# =====================================================

async def question_1(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q1: –ß–∏ —î –¥—ñ—Ç–∏?"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    
    await log_event(user_id, username, "quiz_started", "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–æ—á–∞–≤ –∫–≤—ñ–∑")
    
    keyboard = [
        [InlineKeyboardButton("üë∂ –¢–∞–∫, —î –¥—ñ—Ç–∏", callback_data='q1_yes')],
        [InlineKeyboardButton("‚ùå –ù–µ–º–∞—î –¥—ñ—Ç–µ–π", callback_data='q1_no')]
    ]
    
    await query.edit_message_text(
        TEXT_Q1,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    
    await schedule_quiz_reminder(context, user_id, query.message.chat_id)

async def question_2(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q2: –ó–≥–æ–¥–∞ —Å—É–ø—Ä—É–≥–∞ (–ó –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–û–ú)"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    answer = 'yes' if query.data == 'q1_yes' else 'no'
    context.user_data['has_children'] = answer
    
    await log_event(user_id, username, "q1_answered", f"has_children={answer}")
    
    # –ú–Ü–ö–†–û–ö–û–ú–Ü–¢ (–ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è)
    microcommit = MICROCOMMIT_Q1_YES if answer == 'yes' else MICROCOMMIT_Q1_NO
    
    text = microcommit + TEXT_Q2
    
    keyboard = [
        [InlineKeyboardButton("‚úÖ –¢–∞–∫, –∑–≥–æ–¥–µ–Ω/–Ω–∞", callback_data='q2_yes')],
        [InlineKeyboardButton("‚ùå –ù—ñ, –∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ –ø—Ä–æ—Ç–∏", callback_data='q2_no')],
        [InlineKeyboardButton("ü§∑ –ù–µ –∑–Ω–∞—é / –Ω–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π/–∞", callback_data='q2_unknown')]
    ]
    
    await query.edit_message_text(
        text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    
    await schedule_quiz_reminder(context, user_id, query.message.chat_id)

async def question_3(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q3: –†–æ–∑–¥—ñ–ª –º–∞–π–Ω–∞ (–ó –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–û–ú)"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    consent = query.data.replace('q2_', '')
    context.user_data['spouse_consent'] = consent
    
    await log_event(user_id, username, "q2_answered", f"spouse_consent={consent}")
    
    # –ú–Ü–ö–†–û–ö–û–ú–Ü–¢
    if consent == 'yes':
        microcommit = MICROCOMMIT_Q2_YES
    elif consent == 'no':
        microcommit = MICROCOMMIT_Q2_NO
    else:
        microcommit = MICROCOMMIT_Q2_UNKNOWN
    
    text = microcommit + TEXT_Q3
    
    keyboard = [
        [InlineKeyboardButton("‚úÖ –¢–∞–∫, —î –º–∞–π–Ω–æ –¥–ª—è —Ä–æ–∑–¥—ñ–ª—É", callback_data='q3_yes')],
        [InlineKeyboardButton("‚ùå –ù–µ–º–∞—î / –≤—Å–µ –≤—Ä–µ–≥—É–ª—å–æ–≤–∞–Ω–æ", callback_data='q3_no')],
        [InlineKeyboardButton("ü§∑ –ù–µ –≤–ø–µ–≤–Ω–µ–Ω–∏–π/–∞", callback_data='q3_unsure')]
    ]
    
    await query.edit_message_text(
        text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    
    await schedule_quiz_reminder(context, user_id, query.message.chat_id)

async def question_4(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q4: –ú—ñ—Å—Ü–µ —Å—É–ø—Ä—É–≥–∞ (–ó –Ü–°–¢–û–†–Ü–Ñ–Æ, –ê–õ–ï –ë–ï–ó –ü–ê–£–ó–ò-–ê–ù–û–ù–°–£)"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    chat_id = query.message.chat_id
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ Q3
    property = query.data.replace('q3_', '')
    context.user_data['property_dispute'] = property
    
    await log_event(user_id, username, "q3_answered", f"property_dispute={property}")
    
    # –ú–Ü–ö–†–û–ö–û–ú–Ü–¢
    if property == 'yes':
        microcommit = MICROCOMMIT_Q3_YES
    elif property == 'no':
        microcommit = MICROCOMMIT_Q3_NO
    else:
        microcommit = MICROCOMMIT_Q3_UNSURE
    
    # –û—Ç—Ä–∏–º—É—î–º–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–π —Ç–µ–∫—Å—Ç (–∫–µ–π—Å/–ø—Ä–∏–∫–ª–∞–¥)
    mini_case = get_mini_case(context.user_data)
    
    # 1. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –º—ñ–∫—Ä–æ-–∫–æ–º–º—ñ—Ç (—Ä–µ–¥–∞–≥—É—î–º–æ —Å—Ç–∞—Ä–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)
    await query.edit_message_text(
        microcommit,
        parse_mode='HTML'
    )
    
    # 2. –ù–µ–≤–µ–ª–∏–∫–∞ –ø–∞—É–∑–∞ –¥–ª—è –ø—Ä–∏—Ä–æ–¥–Ω–æ—Å—Ç—ñ (–Ω—ñ–±–∏ –±–æ—Ç –¥—Ä—É–∫—É—î)
    await asyncio.sleep(1.5)
    await context.bot.send_chat_action(chat_id=chat_id, action=ChatAction.TYPING)
    
    # 3. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —ñ—Å—Ç–æ—Ä—ñ—é/–ø—Ä–∏–∫–ª–∞–¥ (–ø—Ä–æ—Å—Ç–æ —Ç–µ–∫—Å—Ç, –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤)
    await context.bot.send_message(
        chat_id=chat_id,
        text=mini_case,
        parse_mode='HTML'
    )
    
    # 4. –ü–∞—É–∑–∞, —â–æ–± –¥–∞—Ç–∏ —á–∞—Å –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ (3 —Å–µ–∫—É–Ω–¥–∏ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Ç–µ–∫—Å—Ç—É)
    await asyncio.sleep(3)
    await context.bot.send_chat_action(chat_id=chat_id, action=ChatAction.TYPING)

    # ... (–∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–µ–π—Å–∞ –∏ –ø–∞—É–∑ –≤—ã—à–µ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ) ...

    # –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ –¥–ª—è Q4 (–û–ù–û–í–õ–ï–ù–ê)
    keyboard_q4 = [
        [InlineKeyboardButton("üá∫üá¶ –ú–∏ –æ–±–∏–¥–≤–∞ –≤ –£–∫—Ä–∞—ó–Ω—ñ", callback_data='q4_ukraine')],
        [InlineKeyboardButton("‚úàÔ∏è –•—Ç–æ—Å—å —ñ–∑ –Ω–∞—Å –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º", callback_data='q4_abroad')], # –í–∫–ª—é—á–∞–µ—Ç: –Ø / –û–Ω / –ú—ã –æ–±–∞
        [InlineKeyboardButton("‚ùì –ù–µ –∑–Ω–∞—é –¥–µ —á–æ–ª–æ–≤—ñ–∫/–¥—Ä—É–∂–∏–Ω–∞", callback_data='q4_unknown')]
    ]
    reply_markup_q4 = InlineKeyboardMarkup(keyboard_q4)

    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ Q4 (–Ω–æ–≤–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º)
    await context.bot.send_message(
        chat_id=chat_id,
        text=TEXT_Q4,
        parse_mode='HTML',
        reply_markup=reply_markup_q4
    )    
    await schedule_quiz_reminder(context, user_id, chat_id)

async def question_5(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q5: –¢–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å (–ó –ú–Ü–ö–†–û–ö–û–ú–Ü–¢–û–ú)"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    location = query.data.replace('q4_', '')
    context.user_data['spouse_location'] = location
    
    await log_event(user_id, username, "q4_answered", f"spouse_location={location}")
    
    # –ú–Ü–ö–†–û–ö–û–ú–Ü–¢
    if location == 'ukraine':
        microcommit = MICROCOMMIT_Q4_UKRAINE
    elif location == 'abroad':
        microcommit = MICROCOMMIT_Q4_ABROAD
    else:
        microcommit = MICROCOMMIT_Q4_UNKNOWN
    
    text = microcommit + TEXT_Q5
    
    keyboard = [
        [InlineKeyboardButton("‚ö°Ô∏è –î—É–∂–µ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ (2-3 –º—ñ—Å)", callback_data='q5_high')],
        [InlineKeyboardButton("‚è≥ –ú–æ–∂—É –ø–æ—á–µ–∫–∞—Ç–∏ (4-6 –º—ñ—Å)", callback_data='q5_medium')],
        [InlineKeyboardButton("ü§∑ –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ", callback_data='q5_low')]
    ]
    
    await query.edit_message_text(
        text,
        parse_mode='HTML',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )
    
    await schedule_quiz_reminder(context, user_id, query.message.chat_id)
# –ó–ê–ú–Ü–ù–ò –¶–Æ –§–£–ù–ö–¶–Ü–Æ –ü–û–í–ù–Ü–°–¢–Æ (–ü–û–í–ï–†–¢–ê–Ñ–ú–û –ü–†–ê–í–ò–õ–¨–ù–£ –õ–û–ì–Ü–ö–£)
async def question_6_phone(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Q6: –ó–∞–ø–∏—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É (–∑ —Ç–∞–π–º–µ—Ä–æ–º –Ω–∞ 60 —Å)"""
    query = update.callback_query
    await query.answer()
    
    user_id = update.effective_user.id
    username = update.effective_user.username
    chat_id = query.message.chat_id
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ Q5
    urgency = query.data.replace('q5_', '')
    context.user_data['urgency'] = urgency
    
    await log_event(user_id, username, "q5_answered", f"urgency={urgency}")

    # –°–∫–∞—Å–æ–≤—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è (15 —Ö–≤)
    await remove_quiz_reminder(context, user_id)
    
    # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ —Ç—É—Ç, —è–∫—â–æ –≤–æ–Ω–∏ –Ω–µ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ –Ω–∞–≥–æ—Ä—ñ
    from telegram import KeyboardButton, ReplyKeyboardMarkup
    
    # –ö–ª–∞–≤—ñ–∞—Ç—É—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Ç—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
    keyboard = [[KeyboardButton("üì± –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –Ω–æ–º–µ—Ä–æ–º", request_contact=True)]]
    reply_markup = ReplyKeyboardMarkup(keyboard, one_time_keyboard=True, resize_keyboard=True)
    
    # 1. –†–µ–¥–∞–≥—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è (–≤—Å—Ç–∞–≤–ª—è—î–º–æ –æ—Å–Ω–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç)
    # –û—Å–∫—ñ–ª—å–∫–∏ TEXT_Q6_PHONE —Ç–µ–ø–µ—Ä –±–µ–∑–ø–µ—á–Ω–∏–π, —Ü–µ –º–∞—î —Å–ø—Ä–∞—Ü—é–≤–∞—Ç–∏
    await query.edit_message_text(TEXT_Q6_PHONE, parse_mode='HTML')
    
    # 2. –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –æ–∫—Ä–µ–º–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫–Ω–æ–ø–∫–æ—é (ReplyKeyboardMarkup)
    await context.bot.send_message(
        chat_id=chat_id,
        text="üëá –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∏–∂—á–µ:",
        reply_markup=reply_markup
    )

    # 3. –ó–∞–ø—É—Å–∫–∞—î–º–æ –°–ü–ï–¶–Ü–ê–õ–¨–ù–ò–ô —Ç–∞–π–º–µ—Ä –Ω–∞ 60 —Å–µ–∫—É–Ω–¥
    context.job_queue.run_once(
        phone_reminder_callback,
        60,
        chat_id=chat_id,
        user_id=user_id,
        name=f"phone_reminder_{user_id}" # –î–æ–¥–∞–≤ —ñ–º'—è –¥–ª—è –ø–æ—Ä—è–¥–∫—É
    )
    logger.info(f"‚è∞ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ —Ç–µ–ª–µ—Ñ–æ–Ω —á–µ—Ä–µ–∑ 60 —Å –¥–ª—è {user_id}")

# =====================================================
# –ó–ê–ì–ê–õ–¨–ù–ê –§–£–ù–ö–¶–Ü–Ø –û–ë–†–û–ë–ö–ò –õ–Ü–î–ê (–î–õ–Ø –ö–ù–û–ü–ö–ò –Ü –¢–ï–ö–°–¢–£)
# =====================================================
async def finalize_lead_processing(update: Update, context: ContextTypes.DEFAULT_TYPE, phone_number: str):
    """–°–ø—ñ–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –æ—Ç—Ä–∏–º–∞–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞ (—á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –∞–±–æ —Ç–µ–∫—Å—Ç)"""
    
    user = update.effective_user
    chat_id = update.effective_chat.id
    
    # –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º'—è –∑ user_data –∞–±–æ –∑ –ø—Ä–æ—Ñ—ñ–ª—é
    first_name = context.user_data.get('first_name') or user.first_name or "–ö–ª—ñ—î–Ω—Ç"
    last_name = context.user_data.get('last_name') or user.last_name or ""
    
    # –û–Ω–æ–≤–ª—é—î–º–æ –¥–∞–Ω—ñ
    context.user_data['first_name'] = first_name
    context.user_data['last_name'] = last_name
    context.user_data['phone_number'] = phone_number
    context.user_data['completed_at'] = datetime.now().isoformat()
    
    # –°–∫–∞—Å–æ–≤—É—î–º–æ —Ç–∞–π–º–µ—Ä –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ —Ç–µ–ª–µ—Ñ–æ–Ω (—è–∫—â–æ –≤—ñ–Ω –±—É–≤)
    try:
        job_name = f"phone_reminder_{user.id}"
        current_jobs = context.job_queue.get_jobs_by_name(job_name)
        for job in current_jobs:
            job.schedule_removal()
    except:
        pass

    user_id = user.id
    username = user.username
    
    await log_event(user_id, username, "phone_shared", f"{first_name} - {phone_number}")
    
    # –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å –≤ All_Users
    if SHEETS_ALL_USERS:
        try:
            cell = SHEETS_ALL_USERS.find(str(user_id), in_column=2)
            if cell:
                SHEETS_ALL_USERS.update_cell(cell.row, 6, "–¢–∞–∫")
        except:
            pass
    
    # –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å–µ–≥–º–µ–Ω—Ç
    segment, segment_name, cost, time = determine_segment(context.user_data)
    context.user_data['segment'] = segment
    context.user_data['segment_name'] = segment_name
    context.user_data['cost_estimate'] = cost
    context.user_data['time_estimate'] = time
    context.user_data['status'] = 'new'
    
    logger.info(f"üìä –ù–æ–≤–∏–π –ª—ñ–¥: {first_name} ({segment} - {segment_name})")
    
    # –ó–±–µ—Ä—ñ–≥–∞—î–º–æ
    await save_to_sheets(context.user_data)
    await send_to_make(context.user_data)
    await send_lead_to_admin(context, context.user_data)
    
    # –ü–æ–¥—è–∫–∞
    thanks_text = f"""
‚úÖ <b>–î—è–∫—É—é, {first_name}!</b>

–ó–∞—Ä–∞–∑ —è —Ä–æ–∑—Ä–∞—Ö—É—é –≤–∞—Ä—Ç—ñ—Å—Ç—å —ñ —Å—Ç—Ä–æ–∫–∏ —Å–∞–º–µ –¥–ª—è –≤–∞—à–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó...
"""
    from telegram import ReplyKeyboardRemove
    await context.bot.send_message(
        chat_id=chat_id,
        text=thanks_text,
        parse_mode='HTML',
        reply_markup=ReplyKeyboardRemove()
    )
    
    # –ü–∞—É–∑–∞
    await asyncio.sleep(2)
    
    # –†–µ–∑—É–ª—å—Ç–∞—Ç
    await send_result(update, context, segment, segment_name, cost, time)
    
    # –ü–∞—É–∑–∞
    await asyncio.sleep(3)
    
    # –û—Ñ—Ñ–µ—Ä (–±–µ–∑ –ø–µ—Ä–µ–¥–∞—á—ñ first_name, —è–∫ –º–∏ —ñ –≤–∏–ø—Ä–∞–≤–∏–ª–∏ —Ä–∞–Ω—ñ—à–µ)
    await send_first_offer(update, context)
    
    # –ü–ª–∞–Ω—É—î–º–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä
    job_name = f"offer_reminder_{user_id}"
    context.job_queue.run_once(
        offer_reminder_callback,
        7200, 
        chat_id=chat_id,
        user_id=user_id,
        name=job_name,
        data=first_name
    )
    logger.info(f"‚è∞ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä –¥–ª—è {user_id} —á–µ—Ä–µ–∑ 2 –≥–æ–¥–∏–Ω–∏")

async def process_contact(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–æ–±–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç—É —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É"""
    contact = update.message.contact
    # –í–∏–∫–ª–∏–∫–∞—î–º–æ —Å–ø—ñ–ª—å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é
    await finalize_lead_processing(update, context, contact.phone_number)

async def save_to_sheets(user_data):
    """–ó–±–µ—Ä—ñ–≥–∞—î –¥–∞–Ω—ñ –ª—ñ–¥–∞ –≤ Google Sheets"""
    
    if SHEETS_LEADS is None:
        logger.warning("‚ö†Ô∏è Google Sheets –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ")
        return
    
    try:
        row = [
            user_data.get('completed_at', ''),
            str(user_data.get('telegram_id', '')),
            user_data.get('username', ''),
            user_data.get('first_name', ''),
            user_data.get('phone_number', ''),
            user_data.get('has_children', ''),
            user_data.get('spouse_consent', ''),
            user_data.get('property_dispute', ''),
            user_data.get('spouse_location', ''),
            user_data.get('urgency', ''),
            user_data.get('segment', ''),
            user_data.get('segment_name', ''),  # –î–û–î–ê–ù–û
            user_data.get('cost_estimate', ''),
            user_data.get('time_estimate', ''),
            user_data.get('status', 'new')
        ]
        
        SHEETS_LEADS.append_row(row)
        logger.info(f"‚úÖ –õ—ñ–¥ –∑–±–µ—Ä–µ–∂–µ–Ω–æ: {user_data.get('first_name')}")
        
    except Exception as e:
        logger.error(f"‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: {e}")

async def send_to_make(user_data):
    """–í—ñ–¥–ø—Ä–∞–≤–ª—è—î webhook –≤ Make.com (–Ø–ö–©–û –ù–ê–õ–ê–®–¢–û–í–ê–ù–û)"""
    
    # üëá –ü–†–ï–î–û–•–†–ê–ù–ò–¢–ï–õ–¨: –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –≤—ã—Ö–æ–¥–∏–º
    if not MAKE_WEBHOOK_URL:
        return 
    
    try:
        payload = {
            'event': 'new_lead',
            'telegram_id': user_data.get('telegram_id'),
            'first_name': user_data.get('first_name'),
            'phone_number': user_data.get('phone_number'),
            'segment': user_data.get('segment'),
            'segment_name': user_data.get('segment_name'),
            'cost_estimate': user_data.get('cost_estimate'),
            'time_estimate': user_data.get('time_estimate'),
            'completed_at': user_data.get('completed_at')
        }
        
        # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ run_in_executor, —â–æ–± requests –Ω–µ –±–ª–æ–∫—É–≤–∞–≤ –±–æ—Ç–∞
        loop = asyncio.get_running_loop()
        await loop.run_in_executor(None, lambda: requests.post(MAKE_WEBHOOK_URL, json=payload, timeout=5))
        logger.info("‚úÖ –î–∞–Ω—ñ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Make")
            
    except Exception as e:
        logger.error(f"‚ö†Ô∏è Make Error (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ): {e}")

async def send_result(update: Update, context: ContextTypes.DEFAULT_TYPE, segment, segment_name, cost, time):
    """–í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç"""
    
    message_template = SEGMENT_MESSAGES.get(segment, SEGMENT_MESSAGES['B2'])
    result_text = message_template.format(
        segment_name=segment_name,
        cost=cost, 
        time=time
    )
    
    await update.message.reply_text(
        result_text,
        parse_mode='HTML'
    )

# –ó–ê–ú–Ü–ù–ò –¶–Æ –§–£–ù–ö–¶–Ü–Æ –ü–û–í–ù–Ü–°–¢–Æ
async def send_first_offer(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–í—ñ–¥–ø—Ä–∞–≤–ª—è—î –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –æ—Ñ—Ñ–µ—Ä (–∑ –Ω–∞–∑–≤–æ—é —Å–µ–≥–º–µ–Ω—Ç—É)"""
    
    # –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º'—è —Ç–∞ —Å–µ–≥–º–µ–Ω—Ç –∑ user_data
    first_name = context.user_data.get('first_name', '–ö–ª—ñ—î–Ω—Ç')
    segment_name = context.user_data.get('segment_name', '–í–∞—à –≤–∏–ø–∞–¥–æ–∫') # –û—Ç—Ä–∏–º—É—î–º–æ –Ω–∞–∑–≤—É —Å–µ–≥–º–µ–Ω—Ç—É
    
    # –ì–µ–Ω–µ—Ä—É—î–º–æ –Ω–æ–≤–∏–π –æ—Ñ—Ñ–µ—Ä, –ø–µ—Ä–µ–¥–∞—é—á–∏ —Ç—É–¥–∏ —ñ–º'—è —Ç–∞ —Å–µ–≥–º–µ–Ω—Ç
    offer_text = get_personalized_offer(first_name, segment_name)
    
    keyboard = [
        [InlineKeyboardButton("üìÖ –û—Ç—Ä–∏–º–∞—Ç–∏ –Ø—Å–Ω—ñ—Å—Ç—å —ñ –ü–ª–∞–Ω (990 –≥—Ä–Ω)", callback_data='book_consultation')]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(
        offer_text,
        parse_mode='HTML',
        reply_markup=reply_markup
    )

# –ó–ê–ú–Ü–ù–ò –¶–Æ –§–£–ù–ö–¶–Ü–Æ –ü–û–í–ù–Ü–°–¢–Æ (–ó –ø–æ–∑–∏—Ç–∏–≤–Ω–æ—é —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é)
async def book_consultation(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Å—É –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é (–ó –ö–û–ù–§–ï–¢–Ü —Ç–∞ –±–æ–Ω—É—Å–æ–º)"""
    
    query = update.callback_query
    await query.answer()
    
    user_data = context.user_data
    user_id = update.effective_user.id
    username = update.effective_user.username
    first_name = user_data.get('first_name', '–ö–ª—ñ—î–Ω—Ç')

    # –°–∫–∞—Å–æ–≤—É—î–º–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä
    job_name = f"offer_reminder_{user_id}"
    current_jobs = context.job_queue.get_jobs_by_name(job_name)
    if current_jobs:
        for job in current_jobs:
            job.schedule_removal()
        logger.info(f"‚è∞ –í–∏–¥–∞–ª–µ–Ω–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä –¥–ª—è {user_id} (—é–∑–µ—Ä –∑–∞–ø–∏—Å–∞–≤—Å—è)")
    
    context.user_data['status'] = 'scheduled'
    
    logger.info(f"üî• –ì–ê–†–Ø–ß–ò–ô –õ–Ü–î! {first_name} —Ö–æ—á–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é!")
    
    await log_event(user_id, username, "consultation_booked", "–ó–∞–ø–∏—Å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é!")
    
    # –û–Ω–æ–≤–ª—é—î–º–æ —Å—Ç–∞—Ç—É—Å –≤ All_Users
    if SHEETS_ALL_USERS:
        try:
            cell = SHEETS_ALL_USERS.find(str(user_id), in_column=2)
            if cell:
                SHEETS_ALL_USERS.update_cell(cell.row, 7, "scheduled")
        except:
            pass
    
    # Webhook –≤ Make
    if MAKE_WEBHOOK_URL:
        try:
            payload = {
                'event': 'consultation_request',
                'telegram_id': user_data.get('telegram_id'),
                'first_name': first_name,
                'phone_number': user_data.get('phone_number'),
                'segment': user_data.get('segment'),
                'segment_name': user_data.get('segment_name')
            }
            requests.post(MAKE_WEBHOOK_URL, json=payload, timeout=5)
        except:
            pass
    
    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ö–û–ù–§–ï–¢–Ü
    try:
        await context.bot.set_message_reaction(
            chat_id=query.message.chat_id,
            message_id=query.message.message_id,
            reaction=[ReactionTypeEmoji(emoji="üéâ")]
        )
    except:
        pass
    
    text = get_consultation_booked_text(first_name, user_data.get('phone_number'))
    
    await query.edit_message_text(text, parse_mode='HTML')
    
    # –î–∞—î–º–æ –º–∏—Ç—Ç—î–≤—É —Ü—ñ–Ω–Ω—ñ—Å—Ç—å + –ü–û–ó–ò–¢–ò–í–ù–£ –Ü–ù–°–¢–†–£–ö–¶–Ü–Æ
    await asyncio.sleep(1)
    await context.bot.send_message(
        chat_id=query.message.chat_id,
        text=f"""
üí° <b>{first_name}, –ø–æ–∫–∏ –≤–∏ –æ—á—ñ–∫—É—î—Ç–µ –¥–∑–≤—ñ–Ω–æ–∫</b> (—Ü–µ 5-15 —Ö–≤), –æ—Å—å —á–µ–∫-–ª–∏—Å—Ç '3 –≥–æ–ª–æ–≤–Ω—ñ –ø–æ–º–∏–ª–∫–∏ –ø—Ä–∏ —Ä–æ–∑–ª—É—á–µ–Ω–Ω—ñ':

<b>1. –ï–º–æ—Ü—ñ–π–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è:</b> –ü–æ—á–∏–Ω–∞—Ç–∏ –¥—ñ–ª–∏—Ç–∏ –º–∞–π–Ω–æ —á–∏ –ø—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–∞ –µ–º–æ—Ü—ñ—è—Ö. 
<i>(–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—Ç—Ä–∞—Ç–∞ –∞–∫—Ç–∏–≤—ñ–≤, –ø—Ä–æ —è–∫—ñ '–∑–∞–±—É–ª–∏').</i>

<b>2. –£—Å–Ω—ñ –¥–æ–º–æ–≤–ª–µ–Ω–æ—Å—Ç—ñ:</b> –í—ñ—Ä–∏—Ç–∏ –æ–±—ñ—Ü—è–Ω–∫–∞–º –ø—Ä–æ –∞–ª—ñ–º–µ–Ω—Ç–∏/–º–∞–π–Ω–æ '–Ω–∞ —Å–ª–æ–≤–∞—Ö'. 
<i>(–†–µ–∑—É–ª—å—Ç–∞—Ç: —á–µ—Ä–µ–∑ —Ä—ñ–∫ –Ω—ñ—Ö—Ç–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –ø–ª–∞—Ç–∏—Ç—å, –¥–æ–≤–µ—Å—Ç–∏ –Ω–µ–º–æ–∂–ª–∏–≤–æ).</i>

<b>3. –ó–∞—Ç—è–≥—É–≤–∞–Ω–Ω—è:</b> –î—É–º–∞—Ç–∏, —â–æ '–≤—Å–µ —Å–∞–º–æ –≤–∏—Ä—ñ—à–∏—Ç—å—Å—è', —ñ –Ω–µ —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å-–∫–≤–æ. 
<i>(–†–µ–∑—É–ª—å—Ç–∞—Ç: —Å—É–ø—Ä—É–≥/–∞ –º–æ–∂–µ –≤–∏–≤–µ—Å—Ç–∏ –∞–∫—Ç–∏–≤–∏ –∞–±–æ –Ω–∞–±—Ä–∞—Ç–∏ –±–æ—Ä–≥—ñ–≤, —è–∫—ñ —Å—Ç–∞–Ω—É—Ç—å —Å–ø—ñ–ª—å–Ω–∏–º–∏).</i>

üìù <b>–©–û –ü–Ü–î–ì–û–¢–£–í–ê–¢–ò –î–û –†–û–ó–ú–û–í–ò:</b>
–©–æ–± –Ω–∞—à–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è –±—É–ª–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—é, –∑–≥–∞–¥–∞–π—Ç–µ (–∞–±–æ –∑–∞–ø–∏—à—ñ—Ç—å) –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω—ñ –¥–∞—Ç–∏ —à–ª—é–±—É, —Å–ø–∏—Å–æ–∫ —Å–ø—ñ–ª—å–Ω–æ–≥–æ –º–∞–π–Ω–∞ —Ç–∞ –≤—ñ–∫ –¥—ñ—Ç–µ–π. –Ø–∫—â–æ —î –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø—ñ–¥ —Ä—É–∫–æ—é ‚Äî —á—É–¥–æ–≤–æ, –∞–ª–µ —Ü–µ –Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –¥–ª—è –ø–µ—Ä—à–æ—ó —Ä–æ–∑–º–æ–≤–∏.
""",
        parse_mode='HTML'
    )

async def handle_text(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–æ–±–∫–∞ —Ç–µ–∫—Å—Ç—É: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É –∞–±–æ –Ω–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞"""
    text = update.message.text
    
    # –ü—Ä–æ—Å—Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: —á–∏ —Å—Ö–æ–∂–µ —Ü–µ –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É?
    # (–®—É–∫–∞—î–º–æ –º—ñ–Ω—ñ–º—É–º 9 —Ü–∏—Ñ—Ä, –º–æ–∂–ª–∏–≤—ñ +, -, –ø—Ä–æ–±—ñ–ª–∏, –¥—É–∂–∫–∏)
    phone_pattern = re.compile(r'[\+\(\)\s\-\d]{9,20}')
    
    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –º–∏ –≤–∑–∞–≥–∞–ª—ñ –Ω–∞ –µ—Ç–∞–ø—ñ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è —Ç–µ–ª–µ—Ñ–æ–Ω—É (–≤–∂–µ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏ –Ω–∞ Q5)
    urgency = context.user_data.get('urgency')
    phone_exists = context.user_data.get('phone_number')
    
    # –Ø–∫—â–æ –º–∏ –Ω–∞ –µ—Ç–∞–ø—ñ –ø—ñ—Å–ª—è Q5 —ñ —â–µ –Ω–µ–º–∞—î —Ç–µ–ª–µ—Ñ–æ–Ω—É, —ñ —Ç–µ–∫—Å—Ç —Å—Ö–æ–∂–∏–π –Ω–∞ –Ω–æ–º–µ—Ä
    if urgency and not phone_exists and phone_pattern.search(text):
        # –¶–µ —Å—Ö–æ–∂–µ –Ω–∞ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É!
        # –û—á–∏—â–∞—î–º–æ –≤—ñ–¥ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, –∑–∞–ª–∏—à–∞—î–º–æ —Ü–∏—Ñ—Ä–∏ —ñ –ø–ª—é—Å
        clean_phone = re.sub(r'[^\d\+]', '', text)
        
        # –Ø–∫—â–æ –¥–æ–≤–∂–∏–Ω–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞ (10-15 —Ü–∏—Ñ—Ä)
        if 9 <= len(clean_phone) <= 15:
            await finalize_lead_processing(update, context, clean_phone)
            return

    # –Ø–∫—â–æ —Ü–µ –Ω–µ –Ω–æ–º–µ—Ä –∞–±–æ –º–∏ –Ω–µ —á–µ–∫–∞—î–º–æ –Ω–æ–º–µ—Ä
    await update.message.reply_text(TEXT_UNKNOWN_MESSAGE)

# =====================================================
# –ù–ê–ì–ê–î–£–í–ê–ù–ù–Ø (–ó–ë–ï–†–ï–ñ–ï–ù–û –ó v3.0)
# =====================================================

def get_quiz_job_name(user_id: int) -> str:
    return f"quiz_reminder_{user_id}"

async def schedule_quiz_reminder(context: ContextTypes.DEFAULT_TYPE, user_id: int, chat_id: int):
    """–ü–ª–∞–Ω—É—î –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∫–≤—ñ–∑ —á–µ—Ä–µ–∑ 15 —Ö–≤–∏–ª–∏–Ω"""
    job_name = get_quiz_job_name(user_id)
    
    # –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ
    current_jobs = context.job_queue.get_jobs_by_name(job_name)
    if current_jobs:
        for job in current_jobs:
            job.schedule_removal()
            logger.info(f"‚è∞ –°–∫–∞—Å–æ–≤–∞–Ω–æ —Å—Ç–∞—Ä–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è {job_name}")

    # –°—Ç–∞–≤–∏–º–æ –Ω–æ–≤—É
    context.job_queue.run_once(
        quiz_reminder_callback,
        900,  # 15 —Ö–≤–∏–ª–∏–Ω
        chat_id=chat_id,
        user_id=user_id,
        name=job_name
    )
    logger.info(f"‚è∞ –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 15 —Ö–≤")

async def remove_quiz_reminder(context: ContextTypes.DEFAULT_TYPE, user_id: int):
    """–í–∏–¥–∞–ª—è—î –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∫–≤—ñ–∑"""
    job_name = get_quiz_job_name(user_id)
    current_jobs = context.job_queue.get_jobs_by_name(job_name)
    if current_jobs:
        for job in current_jobs:
            job.schedule_removal()
        logger.info(f"‚è∞ –í–∏–¥–∞–ª–µ–Ω–æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è {job_name}")

async def phone_reminder_callback(context: ContextTypes.DEFAULT_TYPE):
    """–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É"""
    job = context.job
    user_id = job.user_id
    
    user_data = context.application.user_data.get(user_id)
    phone_exists = user_data and 'phone_number' in user_data
    
    if phone_exists:
        logger.info(f"‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ (–≤–∂–µ —î –Ω–æ–º–µ—Ä)")
        return
    
    logger.info(f"‚è∞ –í–Ü–î–ü–†–ê–í–õ–Ø–Æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –Ω–æ–º–µ—Ä –¥–ª—è {user_id}")
    
    from telegram import KeyboardButton, ReplyKeyboardMarkup
    keyboard = [[KeyboardButton("üì± –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –Ω–æ–º–µ—Ä–æ–º", request_contact=True)]]
    reply_markup = ReplyKeyboardMarkup(keyboard, one_time_keyboard=True, resize_keyboard=True)

    await context.bot.send_message(
        chat_id=job.chat_id,
        text=TEXT_PHONE_REMINDER,
        parse_mode='HTML',
        reply_markup=reply_markup
    )

async def quiz_reminder_callback(context: ContextTypes.DEFAULT_TYPE):
    """–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∫–≤—ñ–∑"""
    job = context.job
    user_id = job.user_id
    
    user_data = context.application.user_data.get(user_id, {})
    if 'phone_number' in user_data:
        logger.info(f"‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ (–∫–≤—ñ–∑ –ø—Ä–æ–π–¥–µ–Ω–æ)")
        return

    logger.info(f"‚è∞ –í–Ü–î–ü–†–ê–í–õ–Ø–Æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –∫–≤—ñ–∑ –¥–ª—è {user_id}")
    await context.bot.send_message(
        chat_id=job.chat_id,
        text=TEXT_QUIZ_REMINDER,
        parse_mode='HTML'
    )

# =====================================================
# –ù–û–í–ê –§–£–ù–ö–¶–Ü–Ø: –ù–ê–ì–ê–î–£–í–ê–ù–ù–Ø –ü–†–û –û–§–§–ï–†
# =====================================================

async def offer_reminder_callback(context: ContextTypes.DEFAULT_TYPE):
    """–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è, —è–∫—â–æ —é–∑–µ—Ä –æ—Ç—Ä–∏–º–∞–≤ –æ—Ñ—Ñ–µ—Ä, –∞–ª–µ –Ω–µ –∑–∞–ø–∏—Å–∞–≤—Å—è"""
    job = context.job
    user_id = job.user_id
    chat_id = job.chat_id
    first_name = job.data  # –û—Ç—Ä–∏–º—É—î–º–æ —ñ–º'—è –∑ 'data'

    # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ user_data, —á–∏ –Ω–µ –∑–∞–ø–∏—Å–∞–≤—Å—è –≤–∂–µ —é–∑–µ—Ä
    # (–ú–∏ –¥–æ–¥–∞–º–æ 'status' –≤ user_data —É —Ñ—É–Ω–∫—Ü—ñ—ó book_consultation)
    user_data = context.application.user_data.get(user_id, {})
    status = user_data.get('status', 'new')

    if status == 'scheduled':
        logger.info(f"‚è∞ –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä —Å–∫–∞—Å–æ–≤–∞–Ω–æ (—Å—Ç–∞—Ç—É—Å 'scheduled') –¥–ª—è {user_id}")
        return

    logger.info(f"‚è∞ –í–Ü–î–ü–†–ê–í–õ–Ø–Æ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –æ—Ñ—Ñ–µ—Ä –¥–ª—è {user_id}")
    
    # –¢–µ–∫—Å—Ç —ñ–∑ —Ç–≤–æ–≥–æ –∂ IMPLEMENTATION_CHECKLIST.md
    text = f"""
{first_name}, —è –±–∞—á—É –≤–∏ —â–µ –Ω–µ –∑–∞–ø–∏—Å–∞–ª–∏—Å—è –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é.

–ú–æ–∂–ª–∏–≤–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è?

–ù–∞–ø–∏—à—ñ—Ç—å –º–µ–Ω—ñ - —è –º–æ–∂—É –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑, 
–∞–±–æ –¥–æ–ø–æ–º–æ–∂—É –∑–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –∑—Ä—É—á–Ω–∏–π –¥–ª—è –≤–∞—Å —á–∞—Å.
"""
    
    # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ —Ç–µ–∫—Å—Ç –ë–ï–ó –∫–Ω–æ–ø–∫–∏, —â–æ–± —Å—Ç–∏–º—É–ª—é–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
    await context.bot.send_message(
        chat_id=chat_id,
        text=text,
        parse_mode='HTML'
    )

# =====================================================
# –ì–û–õ–û–í–ù–ê –§–£–ù–ö–¶–Ü–Ø
# =====================================================

def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    
    logger.info("=" * 60)
    logger.info("ü§ñ –ó–ê–ü–£–°–ö –ë–û–¢–ê v3.1 ULTIMATE IMPROVED")
    logger.info("=" * 60)
    
    # –ó–∞–ø—É—Å–∫–∞—î–º–æ Flask
    flask_thread = threading.Thread(target=run_flask, daemon=True)
    flask_thread.start()
    logger.info("üåê Flask web-server –∑–∞–ø—É—â–µ–Ω–æ")
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ Application
    application = Application.builder().token(BOT_TOKEN).build()
    
    # –†–µ—î—Å—Ç—Ä—É—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CallbackQueryHandler(question_1, pattern='^start_quiz$'))
    application.add_handler(CallbackQueryHandler(question_2, pattern='^q1_'))
    application.add_handler(CallbackQueryHandler(question_3, pattern='^q2_'))
    application.add_handler(CallbackQueryHandler(question_4, pattern='^q3_'))
    application.add_handler(CallbackQueryHandler(question_5, pattern='^q4_'))
    application.add_handler(CallbackQueryHandler(question_6_phone, pattern='^q5_'))
    application.add_handler(CallbackQueryHandler(book_consultation, pattern='^book_consultation$'))
    application.add_handler(MessageHandler(filters.CONTACT, process_contact))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_text))
    
    logger.info("üöÄ –ë–æ—Ç v3.1 –∑–∞–ø—É—â–µ–Ω–æ!")
    logger.info("üìä 10 —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ")
    logger.info("üí¨ –î–µ—Ç–∞–ª—å–Ω—ñ –º–∏–Ω—ñ-–∫–µ–π—Å–∏ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ")
    logger.info("=" * 60)
    
    application.run_polling(allowed_updates=Update.ALL_TYPES)

if __name__ == '__main__':
    main()
